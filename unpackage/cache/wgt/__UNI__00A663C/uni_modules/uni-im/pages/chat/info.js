"use weex:vue";

if (typeof Promise !== 'undefined' && !Promise.prototype.finally) {
  Promise.prototype.finally = function(callback) {
    const promise = this.constructor
    return this.then(
      value => promise.resolve(callback()).then(() => value),
      reason => promise.resolve(callback()).then(() => {
        throw reason
      })
    )
  }
};

if (typeof uni !== 'undefined' && uni && uni.requireGlobal) {
  const global = uni.requireGlobal()
  ArrayBuffer = global.ArrayBuffer
  Int8Array = global.Int8Array
  Uint8Array = global.Uint8Array
  Uint8ClampedArray = global.Uint8ClampedArray
  Int16Array = global.Int16Array
  Uint16Array = global.Uint16Array
  Int32Array = global.Int32Array
  Uint32Array = global.Uint32Array
  Float32Array = global.Float32Array
  Float64Array = global.Float64Array
  BigInt64Array = global.BigInt64Array
  BigUint64Array = global.BigUint64Array
};


(()=>{var Is=Object.create;var gt=Object.defineProperty,Ss=Object.defineProperties,ks=Object.getOwnPropertyDescriptor,xs=Object.getOwnPropertyDescriptors,As=Object.getOwnPropertyNames,Vt=Object.getOwnPropertySymbols,Ps=Object.getPrototypeOf,Yt=Object.prototype.hasOwnProperty,Cs=Object.prototype.propertyIsEnumerable;var Gt=(n,e,t)=>e in n?gt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,N=(n,e)=>{for(var t in e||(e={}))Yt.call(e,t)&&Gt(n,t,e[t]);if(Vt)for(var t of Vt(e))Cs.call(e,t)&&Gt(n,t,e[t]);return n},ee=(n,e)=>Ss(n,xs(e));var Ls=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Os=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of As(e))!Yt.call(n,i)&&i!==t&&gt(n,i,{get:()=>e[i],enumerable:!(s=ks(e,i))||s.enumerable});return n};var Ee=(n,e,t)=>(t=n!=null?Is(Ps(n)):{},Os(e||!n||!n.__esModule?gt(t,"default",{value:n,enumerable:!0}):t,n));var A=(n,e,t)=>new Promise((s,i)=>{var o=u=>{try{r(t.next(u))}catch(c){i(c)}},a=u=>{try{r(t.throw(u))}catch(c){i(c)}},r=u=>u.done?s(u.value):Promise.resolve(u.value).then(o,a);r((t=t.apply(n,e)).next())});var ke=Ls((Ao,Qt)=>{Qt.exports=Vue});var xe=Ee(ke()),Ms=n=>typeof n=="string",Es="onShow",Ds="onHide";function O(n,e,...t){uni.__log__?uni.__log__(n,e,...t):console[n].apply(console,[...t,e])}function pt(n,e){return Ms(n)?e:n}var Xt=n=>(e,t=(0,xe.getCurrentInstance)())=>{!xe.isInSSRComponentSetup&&(0,xe.injectHook)(n,e,t)},Zt=Xt(Es),en=Xt(Ds);var Ae=(n,e)=>{let t=n.__vccOpts||n;for(let[s,i]of e)t[s]=i;return t};var Ft=Ee(ke());var Rs=[{path:"pages/index/index",style:{navigationBarTitleText:"",enablePullDownRefresh:!1}},{path:"uni_modules/uni-im/pages/chat/chat",style:{navigationBarTitleText:"",enablePullDownRefresh:!1,"app-plus":{titleNView:{buttons:[{color:"#333",colorPressed:"#111111",float:"right",text:"...",fontSize:26,onclick:"more"}]}}}},{path:"uni_modules/uni-id-pages/pages/userinfo/realname-verify/realname-verify",style:{enablePullDownRefresh:!1,navigationBarTitleText:"\u5B9E\u540D\u8BA4\u8BC1"}}],Us=[{root:"uni_modules/uni-im/pages",pages:[{path:"index/index",style:{navigationBarTitleText:"\u4F1A\u8BDD\u5217\u8868",enablePullDownRefresh:!1,"app-plus":{titleNView:{buttons:[{color:"#999999",colorPressed:"#111111",float:"right",text:"\u6211\u7684",fontSize:14,onclick:"toLogin"}]}}}},{path:"common/uni-im-code-pages/uni-im-code-pages",style:{navigationBarTitleText:"\u4EE3\u7801\u6D4F\u89C8",enablePullDownRefresh:!1}},{path:"userList/userList",style:{navigationBarTitleText:"\u7528\u6237\u5217\u8868",enablePullDownRefresh:!0}},{path:"common/video/video",style:{navigationBarTitleText:"",enablePullDownRefresh:!1,navigationStyle:"custom"}},{path:"group/info",style:{navigationBarTitleText:"\u7FA4\u4FE1\u606F",enablePullDownRefresh:!1,"app-plus":{titleNView:{buttons:[{color:"#333",colorPressed:"#111111",float:"right",text:"\u7BA1\u7406",fontSize:16,onclick:"more"}]}}}},{path:"contacts/notification/notification",style:{navigationBarTitleText:"",enablePullDownRefresh:!1}},{path:"contacts/contacts",style:{navigationBarTitleText:"\u901A\u8BAF\u5F55",enablePullDownRefresh:!1}},{path:"contacts/addPeopleGroups/addPeopleGroups",style:{navigationStyle:"custom",enablePullDownRefresh:!1}},{path:"contacts/createGroup/createGroup",style:{navigationBarTitleText:"\u521B\u5EFA\u7FA4\u804A",enablePullDownRefresh:!1,maxWidth:950}},{path:"group/groupQRCode",style:{navigationBarTitleText:"\u7FA4\u804A\u4E8C\u7EF4\u7801",enablePullDownRefresh:!1}},{path:"contacts/groupList/groupList",style:{navigationBarTitleText:"\u6211\u7684\u7FA4\u804A",enablePullDownRefresh:!1}},{path:"chat/info",style:{navigationBarTitleText:"\u804A\u5929\u8BBE\u7F6E",enablePullDownRefresh:!1}}]},{root:"uni_modules/uni-id-pages/pages",pages:[{path:"userinfo/userinfo",style:{navigationBarTitleText:"\u4E2A\u4EBA\u8D44\u6599"}},{path:"login/login-withoutpwd"},{path:"login/login-withpwd"},{path:"userinfo/deactivate/deactivate",style:{navigationBarTitleText:"\u6CE8\u9500\u8D26\u53F7"}},{path:"userinfo/bind-mobile/bind-mobile",style:{navigationBarTitleText:"\u7ED1\u5B9A\u624B\u673A\u53F7\u7801"}},{path:"login/login-smscode",style:{navigationBarTitleText:"\u624B\u673A\u9A8C\u8BC1\u7801\u767B\u5F55"}},{path:"register/register",style:{navigationBarTitleText:"\u6CE8\u518C"}},{path:"retrieve/retrieve",style:{navigationBarTitleText:"\u91CD\u7F6E\u5BC6\u7801"}},{path:"common/webview/webview",style:{enablePullDownRefresh:!1,navigationBarTitleText:""}},{path:"userinfo/change_pwd/change_pwd",style:{enablePullDownRefresh:!1,navigationBarTitleText:"\u4FEE\u6539\u5BC6\u7801"}},{path:"register/register-by-email",style:{navigationBarTitleText:"\u90AE\u7BB1\u9A8C\u8BC1\u7801\u6CE8\u518C"}},{path:"retrieve/retrieve-by-email",style:{navigationBarTitleText:"\u901A\u8FC7\u90AE\u7BB1\u91CD\u7F6E\u5BC6\u7801"}},{path:"userinfo/set-pwd/set-pwd",style:{enablePullDownRefresh:!1,navigationBarTitleText:"\u8BBE\u7F6E\u5BC6\u7801"}}]}],Ns={color:"#999999",selectedColor:"#38BC48",borderStyle:"black",backgroundColor:"#FFFFFF",list:[{pagePath:"uni_modules/uni-im/pages/index/index",text:"\u4F1A\u8BDD",iconPath:"uni_modules/uni-im/static/tabbarIcon/chat.png",selectedIconPath:"uni_modules/uni-im/static/tabbarIcon/chatex.png"},{pagePath:"uni_modules/uni-im/pages/userList/userList",text:"\u7528\u6237\u5217\u8868",iconPath:"uni_modules/uni-im/static/tabbarIcon/contacts.png",selectedIconPath:"uni_modules/uni-im/static/tabbarIcon/contactsex.png"},{pagePath:"uni_modules/uni-im/pages/contacts/contacts",text:"\u901A\u8BAF\u5F55",iconPath:"uni_modules/uni-im/static/tabbarIcon/contacts.png",selectedIconPath:"uni_modules/uni-im/static/tabbarIcon/contactsex.png"}]},js={loginPage:"uni_modules/uni-id-pages/pages/login/login-withpwd",needLogin:["uni_modules/uni-im/pages/userList/userList","uni_modules/uni-im/pages/contacts/contacts","pages/index/index"]},Bs={navigationBarTextStyle:"black",navigationBarTitleText:"\u667A\u533B\u804A+",navigationBarBackgroundColor:"#F8F8F8",backgroundColor:"#F8F8F8"},Pe={pages:Rs,subPackages:Us,tabBar:Ns,uniIdRouter:js,globalStyle:Bs};function qs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function ue(n,e,t){return n(t={path:e,exports:{},require:function(s,i){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(i==null&&t.path)}},t.exports),t.exports}var Fs=ue(function(n,e){var t;n.exports=(t=t||function(s,i){var o=Object.create||function(){function l(){}return function(w){var I;return l.prototype=w,I=new l,l.prototype=null,I}}(),a={},r=a.lib={},u=r.Base={extend:function(l){var w=o(this);return l&&w.mixIn(l),w.hasOwnProperty("init")&&this.init!==w.init||(w.init=function(){w.$super.init.apply(this,arguments)}),w.init.prototype=w,w.$super=this,w},create:function(){var l=this.extend();return l.init.apply(l,arguments),l},init:function(){},mixIn:function(l){for(var w in l)l.hasOwnProperty(w)&&(this[w]=l[w]);l.hasOwnProperty("toString")&&(this.toString=l.toString)},clone:function(){return this.init.prototype.extend(this)}},c=r.WordArray=u.extend({init:function(l,w){l=this.words=l||[],this.sigBytes=w!=i?w:4*l.length},toString:function(l){return(l||m).stringify(this)},concat:function(l){var w=this.words,I=l.words,f=this.sigBytes,p=l.sigBytes;if(this.clamp(),f%4)for(var _=0;_<p;_++){var v=I[_>>>2]>>>24-_%4*8&255;w[f+_>>>2]|=v<<24-(f+_)%4*8}else for(_=0;_<p;_+=4)w[f+_>>>2]=I[_>>>2];return this.sigBytes+=p,this},clamp:function(){var l=this.words,w=this.sigBytes;l[w>>>2]&=4294967295<<32-w%4*8,l.length=s.ceil(w/4)},clone:function(){var l=u.clone.call(this);return l.words=this.words.slice(0),l},random:function(l){for(var w,I=[],f=function(v){v=v;var M=987654321,E=4294967295;return function(){var q=((M=36969*(65535&M)+(M>>16)&E)<<16)+(v=18e3*(65535&v)+(v>>16)&E)&E;return q/=4294967296,(q+=.5)*(s.random()>.5?1:-1)}},p=0;p<l;p+=4){var _=f(4294967296*(w||s.random()));w=987654071*_(),I.push(4294967296*_()|0)}return new c.init(I,l)}}),y=a.enc={},m=y.Hex={stringify:function(l){for(var w=l.words,I=l.sigBytes,f=[],p=0;p<I;p++){var _=w[p>>>2]>>>24-p%4*8&255;f.push((_>>>4).toString(16)),f.push((15&_).toString(16))}return f.join("")},parse:function(l){for(var w=l.length,I=[],f=0;f<w;f+=2)I[f>>>3]|=parseInt(l.substr(f,2),16)<<24-f%8*4;return new c.init(I,w/2)}},T=y.Latin1={stringify:function(l){for(var w=l.words,I=l.sigBytes,f=[],p=0;p<I;p++){var _=w[p>>>2]>>>24-p%4*8&255;f.push(String.fromCharCode(_))}return f.join("")},parse:function(l){for(var w=l.length,I=[],f=0;f<w;f++)I[f>>>2]|=(255&l.charCodeAt(f))<<24-f%4*8;return new c.init(I,w)}},h=y.Utf8={stringify:function(l){try{return decodeURIComponent(escape(T.stringify(l)))}catch(w){throw new Error("Malformed UTF-8 data")}},parse:function(l){return T.parse(unescape(encodeURIComponent(l)))}},g=r.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(l){typeof l=="string"&&(l=h.parse(l)),this._data.concat(l),this._nDataBytes+=l.sigBytes},_process:function(l){var w=this._data,I=w.words,f=w.sigBytes,p=this.blockSize,_=f/(4*p),v=(_=l?s.ceil(_):s.max((0|_)-this._minBufferSize,0))*p,M=s.min(4*v,f);if(v){for(var E=0;E<v;E+=p)this._doProcessBlock(I,E);var q=I.splice(0,v);w.sigBytes-=M}return new c.init(q,M)},clone:function(){var l=u.clone.call(this);return l._data=this._data.clone(),l},_minBufferSize:0});r.Hasher=g.extend({cfg:u.extend(),init:function(l){this.cfg=this.cfg.extend(l),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(l){return this._append(l),this._process(),this},finalize:function(l){return l&&this._append(l),this._doFinalize()},blockSize:16,_createHelper:function(l){return function(w,I){return new l.init(I).finalize(w)}},_createHmacHelper:function(l){return function(w,I){return new d.HMAC.init(l,I).finalize(w)}}});var d=a.algo={};return a}(Math),t)}),ye=Fs,$s=(ue(function(n,e){var t;n.exports=(t=ye,function(s){var i=t,o=i.lib,a=o.WordArray,r=o.Hasher,u=i.algo,c=[];(function(){for(var d=0;d<64;d++)c[d]=4294967296*s.abs(s.sin(d+1))|0})();var y=u.MD5=r.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(d,l){for(var w=0;w<16;w++){var I=l+w,f=d[I];d[I]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8)}var p=this._hash.words,_=d[l+0],v=d[l+1],M=d[l+2],E=d[l+3],q=d[l+4],X=d[l+5],H=d[l+6],te=d[l+7],Z=d[l+8],ie=d[l+9],ne=d[l+10],le=d[l+11],de=d[l+12],he=d[l+13],fe=d[l+14],ge=d[l+15],S=p[0],k=p[1],x=p[2],b=p[3];S=m(S,k,x,b,_,7,c[0]),b=m(b,S,k,x,v,12,c[1]),x=m(x,b,S,k,M,17,c[2]),k=m(k,x,b,S,E,22,c[3]),S=m(S,k,x,b,q,7,c[4]),b=m(b,S,k,x,X,12,c[5]),x=m(x,b,S,k,H,17,c[6]),k=m(k,x,b,S,te,22,c[7]),S=m(S,k,x,b,Z,7,c[8]),b=m(b,S,k,x,ie,12,c[9]),x=m(x,b,S,k,ne,17,c[10]),k=m(k,x,b,S,le,22,c[11]),S=m(S,k,x,b,de,7,c[12]),b=m(b,S,k,x,he,12,c[13]),x=m(x,b,S,k,fe,17,c[14]),S=T(S,k=m(k,x,b,S,ge,22,c[15]),x,b,v,5,c[16]),b=T(b,S,k,x,H,9,c[17]),x=T(x,b,S,k,le,14,c[18]),k=T(k,x,b,S,_,20,c[19]),S=T(S,k,x,b,X,5,c[20]),b=T(b,S,k,x,ne,9,c[21]),x=T(x,b,S,k,ge,14,c[22]),k=T(k,x,b,S,q,20,c[23]),S=T(S,k,x,b,ie,5,c[24]),b=T(b,S,k,x,fe,9,c[25]),x=T(x,b,S,k,E,14,c[26]),k=T(k,x,b,S,Z,20,c[27]),S=T(S,k,x,b,he,5,c[28]),b=T(b,S,k,x,M,9,c[29]),x=T(x,b,S,k,te,14,c[30]),S=h(S,k=T(k,x,b,S,de,20,c[31]),x,b,X,4,c[32]),b=h(b,S,k,x,Z,11,c[33]),x=h(x,b,S,k,le,16,c[34]),k=h(k,x,b,S,fe,23,c[35]),S=h(S,k,x,b,v,4,c[36]),b=h(b,S,k,x,q,11,c[37]),x=h(x,b,S,k,te,16,c[38]),k=h(k,x,b,S,ne,23,c[39]),S=h(S,k,x,b,he,4,c[40]),b=h(b,S,k,x,_,11,c[41]),x=h(x,b,S,k,E,16,c[42]),k=h(k,x,b,S,H,23,c[43]),S=h(S,k,x,b,ie,4,c[44]),b=h(b,S,k,x,de,11,c[45]),x=h(x,b,S,k,ge,16,c[46]),S=g(S,k=h(k,x,b,S,M,23,c[47]),x,b,_,6,c[48]),b=g(b,S,k,x,te,10,c[49]),x=g(x,b,S,k,fe,15,c[50]),k=g(k,x,b,S,X,21,c[51]),S=g(S,k,x,b,de,6,c[52]),b=g(b,S,k,x,E,10,c[53]),x=g(x,b,S,k,ne,15,c[54]),k=g(k,x,b,S,v,21,c[55]),S=g(S,k,x,b,Z,6,c[56]),b=g(b,S,k,x,ge,10,c[57]),x=g(x,b,S,k,H,15,c[58]),k=g(k,x,b,S,he,21,c[59]),S=g(S,k,x,b,q,6,c[60]),b=g(b,S,k,x,le,10,c[61]),x=g(x,b,S,k,M,15,c[62]),k=g(k,x,b,S,ie,21,c[63]),p[0]=p[0]+S|0,p[1]=p[1]+k|0,p[2]=p[2]+x|0,p[3]=p[3]+b|0},_doFinalize:function(){var d=this._data,l=d.words,w=8*this._nDataBytes,I=8*d.sigBytes;l[I>>>5]|=128<<24-I%32;var f=s.floor(w/4294967296),p=w;l[15+(I+64>>>9<<4)]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),l[14+(I+64>>>9<<4)]=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),d.sigBytes=4*(l.length+1),this._process();for(var _=this._hash,v=_.words,M=0;M<4;M++){var E=v[M];v[M]=16711935&(E<<8|E>>>24)|4278255360&(E<<24|E>>>8)}return _},clone:function(){var d=r.clone.call(this);return d._hash=this._hash.clone(),d}});function m(d,l,w,I,f,p,_){var v=d+(l&w|~l&I)+f+_;return(v<<p|v>>>32-p)+l}function T(d,l,w,I,f,p,_){var v=d+(l&I|w&~I)+f+_;return(v<<p|v>>>32-p)+l}function h(d,l,w,I,f,p,_){var v=d+(l^w^I)+f+_;return(v<<p|v>>>32-p)+l}function g(d,l,w,I,f,p,_){var v=d+(w^(l|~I))+f+_;return(v<<p|v>>>32-p)+l}i.MD5=r._createHelper(y),i.HmacMD5=r._createHmacHelper(y)}(Math),t.MD5)}),ue(function(n,e){var t;n.exports=(t=ye,void function(){var s=t,i=s.lib.Base,o=s.enc.Utf8;s.algo.HMAC=i.extend({init:function(a,r){a=this._hasher=new a.init,typeof r=="string"&&(r=o.parse(r));var u=a.blockSize,c=4*u;r.sigBytes>c&&(r=a.finalize(r)),r.clamp();for(var y=this._oKey=r.clone(),m=this._iKey=r.clone(),T=y.words,h=m.words,g=0;g<u;g++)T[g]^=1549556828,h[g]^=909522486;y.sigBytes=m.sigBytes=c,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var r=this._hasher,u=r.finalize(a);return r.reset(),r.finalize(this._oKey.clone().concat(u))}})}())}),ue(function(n,e){n.exports=ye.HmacMD5})),Hs=ue(function(n,e){n.exports=ye.enc.Utf8}),Ws=ue(function(n,e){var t;n.exports=(t=ye,function(){var s=t,i=s.lib.WordArray;function o(a,r,u){for(var c=[],y=0,m=0;m<r;m++)if(m%4){var T=u[a.charCodeAt(m-1)]<<m%4*2,h=u[a.charCodeAt(m)]>>>6-m%4*2;c[y>>>2]|=(T|h)<<24-y%4*8,y++}return i.create(c,y)}s.enc.Base64={stringify:function(a){var r=a.words,u=a.sigBytes,c=this._map;a.clamp();for(var y=[],m=0;m<u;m+=3)for(var T=(r[m>>>2]>>>24-m%4*8&255)<<16|(r[m+1>>>2]>>>24-(m+1)%4*8&255)<<8|r[m+2>>>2]>>>24-(m+2)%4*8&255,h=0;h<4&&m+.75*h<u;h++)y.push(c.charAt(T>>>6*(3-h)&63));var g=c.charAt(64);if(g)for(;y.length%4;)y.push(g);return y.join("")},parse:function(a){var r=a.length,u=this._map,c=this._reverseMap;if(!c){c=this._reverseMap=[];for(var y=0;y<u.length;y++)c[u.charCodeAt(y)]=y}var m=u.charAt(64);if(m){var T=a.indexOf(m);T!==-1&&(r=T)}return o(a,r,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.enc.Base64)}),tn="FUNCTION",Ks="OBJECT",Js="CLIENT_DB",nn="pending",zs="fulfilled",sn="rejected";function qe(n){return Object.prototype.toString.call(n).slice(8,-1).toLowerCase()}function Un(n){return qe(n)==="object"}function Nn(n){return typeof n=="function"}function Vs(n){return function(){try{return n.apply(n,arguments)}catch(e){console.error(e)}}}var on="REJECTED",jn="NOT_PENDING",nt=class{constructor({createPromise:e,retryRule:t=on}={}){this.createPromise=e,this.status=null,this.promise=null,this.retryRule=t}get needRetry(){if(!this.status)return!0;switch(this.retryRule){case on:return this.status===sn;case jn:return this.status!==nn}}exec(){return this.needRetry?(this.status=nn,this.promise=this.createPromise().then(e=>(this.status=zs,Promise.resolve(e)),e=>(this.status=sn,Promise.reject(e))),this.promise):this.promise}};function $t(n){return n&&typeof n=="string"?JSON.parse(n):n}var Gs=!1,Ys="app",Qs=$t([]),Bn=Ys;$t("");var Xs=$t('[{"provider":"aliyun","spaceName":"chat-kyxf","spaceId":"mp-e3582cd1-8371-4a89-9221-663dc8b8b2a5","clientSecret":"QHrHbGTbhDOgGvAPLvpJPw=="}]')||[],Zs="";try{Zs="__UNI__00A663C"}catch(n){}var tt={};function Ce(n,e={}){var t,s;return t=tt,s=n,Object.prototype.hasOwnProperty.call(t,s)||(tt[n]=e),tt[n]}tt=uni._globalUniCloudObj?uni._globalUniCloudObj:uni._globalUniCloudObj={};var qn=["invoke","success","fail","complete"],ae=Ce("_globalUniCloudInterceptor");function Fn(n,e){ae[n]||(ae[n]={}),Un(e)&&Object.keys(e).forEach(t=>{qn.indexOf(t)>-1&&function(s,i,o){let a=ae[s][i];a||(a=ae[s][i]=[]),a.indexOf(o)===-1&&Nn(o)&&a.push(o)}(n,t,e[t])})}function ei(n,e){ae[n]||(ae[n]={}),Un(e)?Object.keys(e).forEach(t=>{qn.indexOf(t)>-1&&function(s,i,o){let a=ae[s][i];if(!a)return;let r=a.indexOf(o);r>-1&&a.splice(r,1)}(n,t,e[t])}):delete ae[n]}function V(n,e){return n&&n.length!==0?n.reduce((t,s)=>t.then(()=>s(e)),Promise.resolve()):Promise.resolve()}function G(n,e){return ae[n]&&ae[n][e]||[]}function ti(n){Fn("callObject",n)}var mt=Ce("_globalUniCloudListener"),ce="response",Le="needLogin",st="refreshToken",rn="clientdb",Ge="cloudfunction",an="cloudobject";function Ke(n){return mt[n]||(mt[n]=[]),mt[n]}function _t(n,e){let t=Ke(n);t.includes(e)||t.push(e)}function yt(n,e){let t=Ke(n),s=t.indexOf(e);s!==-1&&t.splice(s,1)}function se(n,e){let t=Ke(n);for(let s=0;s<t.length;s++)(0,t[s])(e)}var vt,wt=!1;function $n(){return vt||(vt=new Promise(n=>{wt&&n(),function e(){if(typeof getCurrentPages=="function"){let t=getCurrentPages();t&&t[0]&&(wt=!0,n())}wt||setTimeout(()=>{e()},30)}()}),vt)}function Hn(n){let e={};for(let t in n){let s=n[t];Nn(s)&&(e[t]=Vs(s))}return e}var P=class extends Error{constructor(e){super(e.message),this.errMsg=e.message||e.errMsg||"unknown system error",this.code=this.errCode=e.code||e.errCode||"SYSTEM_ERROR",this.errSubject=this.subject=e.subject||e.errSubject,this.cause=e.cause,this.requestId=e.requestId}toJson(e=0){if(!(e>=10))return e++,{errCode:this.errCode,errMsg:this.errMsg,errSubject:this.errSubject,cause:this.cause&&this.cause.toJson?this.cause.toJson(e):this.cause}}},Y={request:n=>uni.request(n),uploadFile:n=>uni.uploadFile(n),setStorageSync:(n,e)=>uni.setStorageSync(n,e),getStorageSync:n=>uni.getStorageSync(n),removeStorageSync:n=>uni.removeStorageSync(n),clearStorageSync:()=>uni.clearStorageSync()};function Wn(n){return n&&Wn(n.__v_raw)||n}function ht(){return{token:Y.getStorageSync("uni_id_token")||Y.getStorageSync("uniIdToken"),tokenExpired:Y.getStorageSync("uni_id_token_expired")}}function Kn({token:n,tokenExpired:e}={}){n&&Y.setStorageSync("uni_id_token",n),e&&Y.setStorageSync("uni_id_token_expired",e)}var bt,Ye;function Jn(){return bt||(bt=uni.getSystemInfoSync()),bt}function ni(){let n,e;try{if(uni.getLaunchOptionsSync){if(uni.getLaunchOptionsSync.toString().indexOf("not yet implemented")>-1)return;let{scene:t,channel:s}=uni.getLaunchOptionsSync();n=s,e=t}}catch(t){}return{channel:n,scene:e}}function zn(){let n=uni.getLocale&&uni.getLocale()||"en";if(Ye)return ee(N({},Ye),{locale:n,LOCALE:n});let e=Jn(),{deviceId:t,osName:s,uniPlatform:i,appId:o}=e,a=["pixelRatio","brand","model","system","language","version","platform","host","SDKVersion","swanNativeVersion","app","AppPlatform","fontSizeSetting"];for(let r=0;r<a.length;r++)delete e[a[r]];return Ye=N(N({PLATFORM:i,OS:s,APPID:o,DEVICEID:t},ni()),e),ee(N({},Ye),{locale:n,LOCALE:n})}var Ue={sign:function(n,e){let t="";return Object.keys(n).sort().forEach(function(s){n[s]&&(t=t+"&"+s+"="+n[s])}),t=t.slice(1),$s(t,e).toString()},wrappedRequest:function(n,e){return new Promise((t,s)=>{e(Object.assign(n,{complete(i){i||(i={});let o=i.data&&i.data.header&&i.data.header["x-serverless-request-id"]||i.header&&i.header["request-id"];if(!i.statusCode||i.statusCode>=400)return s(new P({code:"SYS_ERR",message:i.errMsg||"request:fail",requestId:o}));let a=i.data;if(a.error)return s(new P({code:a.error.code,message:a.error.message,requestId:o}));a.result=a.data,a.requestId=o,delete a.data,t(a)}}))})},toBase64:function(n){return Ws.stringify(Hs.parse(n))}},Vn=class{constructor(n){["spaceId","clientSecret"].forEach(e=>{if(!Object.prototype.hasOwnProperty.call(n,e))throw new Error(`${e} required`)}),this.config=Object.assign({},{endpoint:n.spaceId.indexOf("mp-")===0?"https://api.next.bspapp.com":"https://api.bspapp.com"},n),this.config.provider="aliyun",this.config.requestUrl=this.config.endpoint+"/client",this.config.envType=this.config.envType||"public",this.config.accessTokenKey="access_token_"+this.config.spaceId,this.adapter=Y,this._getAccessTokenPromiseHub=new nt({createPromise:()=>this.requestAuth(this.setupRequest({method:"serverless.auth.user.anonymousAuthorize",params:"{}"},"auth")).then(e=>{if(!e.result||!e.result.accessToken)throw new P({code:"AUTH_FAILED",message:"\u83B7\u53D6accessToken\u5931\u8D25"});this.setAccessToken(e.result.accessToken)}),retryRule:jn})}get hasAccessToken(){return!!this.accessToken}setAccessToken(n){this.accessToken=n}requestWrapped(n){return Ue.wrappedRequest(n,this.adapter.request)}requestAuth(n){return this.requestWrapped(n)}request(n,e){return Promise.resolve().then(()=>this.hasAccessToken?e?this.requestWrapped(n):this.requestWrapped(n).catch(t=>new Promise((s,i)=>{!t||t.code!=="GATEWAY_INVALID_TOKEN"&&t.code!=="InvalidParameter.InvalidToken"?i(t):s()}).then(()=>this.getAccessToken()).then(()=>{let s=this.rebuildRequest(n);return this.request(s,!0)})):this.getAccessToken().then(()=>{let t=this.rebuildRequest(n);return this.request(t,!0)}))}rebuildRequest(n){let e=Object.assign({},n);return e.data.token=this.accessToken,e.header["x-basement-token"]=this.accessToken,e.header["x-serverless-sign"]=Ue.sign(e.data,this.config.clientSecret),e}setupRequest(n,e){let t=Object.assign({},n,{spaceId:this.config.spaceId,timestamp:Date.now()}),s={"Content-Type":"application/json"};return e!=="auth"&&(t.token=this.accessToken,s["x-basement-token"]=this.accessToken),s["x-serverless-sign"]=Ue.sign(t,this.config.clientSecret),{url:this.config.requestUrl,method:"POST",data:t,dataType:"json",header:s}}getAccessToken(){return this._getAccessTokenPromiseHub.exec()}authorize(){return A(this,null,function*(){yield this.getAccessToken()})}callFunction(n){let e={method:"serverless.function.runtime.invoke",params:JSON.stringify({functionTarget:n.name,functionArgs:n.data||{}})};return this.request(this.setupRequest(e))}getOSSUploadOptionsFromPath(n){let e={method:"serverless.file.resource.generateProximalSign",params:JSON.stringify(n)};return this.request(this.setupRequest(e))}uploadFileToOSS({url:n,formData:e,name:t,filePath:s,fileType:i,onUploadProgress:o}){return new Promise((a,r)=>{let u=this.adapter.uploadFile({url:n,formData:e,name:t,filePath:s,fileType:i,header:{"X-OSS-server-side-encrpytion":"AES256"},success(c){c&&c.statusCode<400?a(c):r(new P({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))},fail(c){r(new P({code:c.code||"UPLOAD_FAILED",message:c.message||c.errMsg||"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}});typeof o=="function"&&u&&typeof u.onProgressUpdate=="function"&&u.onProgressUpdate(c=>{o({loaded:c.totalBytesSent,total:c.totalBytesExpectedToSend})})})}reportOSSUpload(n){let e={method:"serverless.file.resource.report",params:JSON.stringify(n)};return this.request(this.setupRequest(e))}uploadFile(a){return A(this,arguments,function*({filePath:n,cloudPath:e,fileType:t="image",cloudPathAsRealPath:s=!1,onUploadProgress:i,config:o}){if(qe(e)!=="string")throw new P({code:"INVALID_PARAM",message:"cloudPath\u5FC5\u987B\u4E3A\u5B57\u7B26\u4E32\u7C7B\u578B"});if(!(e=e.trim()))throw new P({code:"INVALID_PARAM",message:"cloudPath\u4E0D\u53EF\u4E3A\u7A7A"});if(/:\/\//.test(e))throw new P({code:"INVALID_PARAM",message:"cloudPath\u4E0D\u5408\u6CD5"});let r=o&&o.envType||this.config.envType;if(s&&(e[0]!=="/"&&(e="/"+e),e.indexOf("\\")>-1))throw new P({code:"INVALID_PARAM",message:"\u4F7F\u7528cloudPath\u4F5C\u4E3A\u8DEF\u5F84\u65F6\uFF0CcloudPath\u4E0D\u53EF\u5305\u542B\u201C\\\u201D"});let u=(yield this.getOSSUploadOptionsFromPath({env:r,filename:s?e.split("/").pop():e,fileId:s?e:void 0})).result,c="https://"+u.cdnDomain+"/"+u.ossPath,{securityToken:y,accessKeyId:m,signature:T,host:h,ossPath:g,id:d,policy:l,ossCallbackUrl:w}=u,I={"Cache-Control":"max-age=2592000","Content-Disposition":"attachment",OSSAccessKeyId:m,Signature:T,host:h,id:d,key:g,policy:l,success_action_status:200};if(y&&(I["x-oss-security-token"]=y),w){let p=JSON.stringify({callbackUrl:w,callbackBody:JSON.stringify({fileId:d,spaceId:this.config.spaceId}),callbackBodyType:"application/json"});I.callback=Ue.toBase64(p)}let f={url:"https://"+u.host,formData:I,fileName:"file",name:"file",filePath:n,fileType:t};if(yield this.uploadFileToOSS(Object.assign({},f,{onUploadProgress:i})),w)return{success:!0,filePath:n,fileID:c};if((yield this.reportOSSUpload({id:d})).success)return{success:!0,filePath:n,fileID:c};throw new P({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"})})}getTempFileURL({fileList:n}={}){return new Promise((e,t)=>{Array.isArray(n)&&n.length!==0||t(new P({code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u5B57\u7B26\u4E32"})),e({fileList:n.map(s=>({fileID:s,tempFileURL:s}))})})}getFileInfo(){return A(this,arguments,function*({fileList:n}={}){if(!Array.isArray(n)||n.length===0)throw new P({code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u5B57\u7B26\u4E32"});let e={method:"serverless.file.resource.info",params:JSON.stringify({id:n.map(t=>t.split("?")[0]).join(",")})};return{fileList:(yield this.request(this.setupRequest(e))).result}})}},si={init(n){let e=new Vn(n),t={signInAnonymously:function(){return e.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return e.auth=function(){return t},e.customAuth=e.auth,e}},ii=typeof location!="undefined"&&location.protocol==="http:"?"http:":"https:",cn;(function(n){n.local="local",n.none="none",n.session="session"})(cn||(cn={}));var oi=function(){},ri=ue(function(n,e){var t;n.exports=(t=ye,function(s){var i=t,o=i.lib,a=o.WordArray,r=o.Hasher,u=i.algo,c=[],y=[];(function(){function h(w){for(var I=s.sqrt(w),f=2;f<=I;f++)if(!(w%f))return!1;return!0}function g(w){return 4294967296*(w-(0|w))|0}for(var d=2,l=0;l<64;)h(d)&&(l<8&&(c[l]=g(s.pow(d,.5))),y[l]=g(s.pow(d,1/3)),l++),d++})();var m=[],T=u.SHA256=r.extend({_doReset:function(){this._hash=new a.init(c.slice(0))},_doProcessBlock:function(h,g){for(var d=this._hash.words,l=d[0],w=d[1],I=d[2],f=d[3],p=d[4],_=d[5],v=d[6],M=d[7],E=0;E<64;E++){if(E<16)m[E]=0|h[g+E];else{var q=m[E-15],X=(q<<25|q>>>7)^(q<<14|q>>>18)^q>>>3,H=m[E-2],te=(H<<15|H>>>17)^(H<<13|H>>>19)^H>>>10;m[E]=X+m[E-7]+te+m[E-16]}var Z=l&w^l&I^w&I,ie=(l<<30|l>>>2)^(l<<19|l>>>13)^(l<<10|l>>>22),ne=M+((p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25))+(p&_^~p&v)+y[E]+m[E];M=v,v=_,_=p,p=f+ne|0,f=I,I=w,w=l,l=ne+(ie+Z)|0}d[0]=d[0]+l|0,d[1]=d[1]+w|0,d[2]=d[2]+I|0,d[3]=d[3]+f|0,d[4]=d[4]+p|0,d[5]=d[5]+_|0,d[6]=d[6]+v|0,d[7]=d[7]+M|0},_doFinalize:function(){var h=this._data,g=h.words,d=8*this._nDataBytes,l=8*h.sigBytes;return g[l>>>5]|=128<<24-l%32,g[14+(l+64>>>9<<4)]=s.floor(d/4294967296),g[15+(l+64>>>9<<4)]=d,h.sigBytes=4*g.length,this._process(),this._hash},clone:function(){var h=r.clone.call(this);return h._hash=this._hash.clone(),h}});i.SHA256=r._createHelper(T),i.HmacSHA256=r._createHmacHelper(T)}(Math),t.SHA256)}),un=ri,ai=ue(function(n,e){n.exports=ye.HmacSHA256}),Je=()=>{let n;if(!Promise){n=()=>{},n.promise={};let t=()=>{throw new P({message:'Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.'})};return Object.defineProperty(n.promise,"then",{get:t}),Object.defineProperty(n.promise,"catch",{get:t}),n}let e=new Promise((t,s)=>{n=(i,o)=>i?s(i):t(o)});return n.promise=e,n};function ci(n){return n===void 0}function ui(n){return Object.prototype.toString.call(n)==="[object Null]"}var ln;function li(n){let e=(t=n,Object.prototype.toString.call(t)==="[object Array]"?n:[n]);var t;for(let s of e){let{isMatch:i,genAdapter:o,runtime:a}=s;if(i())return{adapter:o(),runtime:a}}}(function(n){n.WEB="web",n.WX_MP="wx_mp"})(ln||(ln={}));var z={adapter:null,runtime:void 0},di=["anonymousUuidKey"],Ne=class extends oi{constructor(){super(),z.adapter.root.tcbObject||(z.adapter.root.tcbObject={})}setItem(e,t){z.adapter.root.tcbObject[e]=t}getItem(e){return z.adapter.root.tcbObject[e]}removeItem(e){delete z.adapter.root.tcbObject[e]}clear(){delete z.adapter.root.tcbObject}};function dn(n,e){switch(n){case"local":return e.localStorage||new Ne;case"none":return new Ne;default:return e.sessionStorage||new Ne}}var it=class{constructor(e){if(!this._storage){this._persistence=z.adapter.primaryStorage||e.persistence,this._storage=dn(this._persistence,z.adapter);let t=`access_token_${e.env}`,s=`access_token_expire_${e.env}`,i=`refresh_token_${e.env}`,o=`anonymous_uuid_${e.env}`,a=`login_type_${e.env}`,r=`user_info_${e.env}`;this.keys={accessTokenKey:t,accessTokenExpireKey:s,refreshTokenKey:i,anonymousUuidKey:o,loginTypeKey:a,userInfoKey:r}}}updatePersistence(e){if(e===this._persistence)return;let t=this._persistence==="local";this._persistence=e;let s=dn(e,z.adapter);for(let i in this.keys){let o=this.keys[i];if(t&&di.includes(i))continue;let a=this._storage.getItem(o);ci(a)||ui(a)||(s.setItem(o,a),this._storage.removeItem(o))}this._storage=s}setStore(e,t,s){if(!this._storage)return;let i={version:s||"localCachev1",content:t},o=JSON.stringify(i);try{this._storage.setItem(e,o)}catch(a){throw a}}getStore(e,t){try{if(!this._storage)return}catch(i){return""}t=t||"localCachev1";let s=this._storage.getItem(e);return s&&s.indexOf(t)>=0?JSON.parse(s).content:""}removeStore(e){this._storage.removeItem(e)}},Gn={},Yn={};function ze(n){return Gn[n]}var ot=class{constructor(e,t){this.data=t||null,this.name=e}},Ct=class extends ot{constructor(e,t){super("error",{error:e,data:t}),this.error=e}},Ht=new class{constructor(){this._listeners={}}on(n,e){return function(t,s,i){i[t]=i[t]||[],i[t].push(s)}(n,e,this._listeners),this}off(n,e){return function(t,s,i){if(i&&i[t]){let o=i[t].indexOf(s);o!==-1&&i[t].splice(o,1)}}(n,e,this._listeners),this}fire(n,e){if(n instanceof Ct)return console.error(n.error),this;let t=typeof n=="string"?new ot(n,e||{}):n,s=t.name;if(this._listens(s)){t.target=this;let i=this._listeners[s]?[...this._listeners[s]]:[];for(let o of i)o.call(this,t)}return this}_listens(n){return this._listeners[n]&&this._listeners[n].length>0}};function _e(n,e){Ht.on(n,e)}function Q(n,e={}){Ht.fire(n,e)}function hi(n,e){Ht.off(n,e)}var Oe="loginStateChanged",Qn="loginStateExpire",ve="loginTypeChanged",Lt="anonymousConverted",Xn="refreshAccessToken",J;(function(n){n.ANONYMOUS="ANONYMOUS",n.WECHAT="WECHAT",n.WECHAT_PUBLIC="WECHAT-PUBLIC",n.WECHAT_OPEN="WECHAT-OPEN",n.CUSTOM="CUSTOM",n.EMAIL="EMAIL",n.USERNAME="USERNAME",n.NULL="NULL"})(J||(J={}));var hn=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"],fi={"X-SDK-Version":"1.3.5"};function Tt(n,e,t){let s=n[e];n[e]=function(i){let o={},a={};t.forEach(u=>{let{data:c,headers:y}=u.call(n,i);Object.assign(o,c),Object.assign(a,y)});let r=i.data;return r&&(()=>{var u;if(u=r,Object.prototype.toString.call(u)!=="[object FormData]")i.data=N(N({},r),o);else for(let c in o)r.append(c,o[c])})(),i.headers=N(N({},i.headers||{}),a),s.call(n,i)}}function It(){let n=Math.random().toString(16).slice(2);return{data:{seqId:n},headers:ee(N({},fi),{"x-seqid":n})}}var Ot=class{constructor(e={}){var t;this.config=e,this._reqClass=new z.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:`\u8BF7\u6C42\u5728${this.config.timeout/1e3}s\u5185\u672A\u5B8C\u6210\uFF0C\u5DF2\u4E2D\u65AD`,restrictedMethods:["post"]}),this._cache=ze(this.config.env),this._localCache=(t=this.config.env,Yn[t]),Tt(this._reqClass,"post",[It]),Tt(this._reqClass,"upload",[It]),Tt(this._reqClass,"download",[It])}post(e){return A(this,null,function*(){return yield this._reqClass.post(e)})}upload(e){return A(this,null,function*(){return yield this._reqClass.upload(e)})}download(e){return A(this,null,function*(){return yield this._reqClass.download(e)})}refreshAccessToken(){return A(this,null,function*(){let e,t;this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken());try{e=yield this._refreshAccessTokenPromise}catch(s){t=s}if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,t)throw t;return e})}_refreshAccessToken(){return A(this,null,function*(){let{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:s,loginTypeKey:i,anonymousUuidKey:o}=this._cache.keys;this._cache.removeStore(e),this._cache.removeStore(t);let a=this._cache.getStore(s);if(!a)throw new P({message:"\u672A\u767B\u5F55CloudBase"});let r={refresh_token:a},u=yield this.request("auth.fetchAccessTokenWithRefreshToken",r);if(u.data.code){let{code:c}=u.data;if(c==="SIGN_PARAM_INVALID"||c==="REFRESH_TOKEN_EXPIRED"||c==="INVALID_REFRESH_TOKEN"){if(this._cache.getStore(i)===J.ANONYMOUS&&c==="INVALID_REFRESH_TOKEN"){let y=this._cache.getStore(o),m=this._cache.getStore(s),T=yield this.send("auth.signInAnonymously",{anonymous_uuid:y,refresh_token:m});return this.setRefreshToken(T.refresh_token),this._refreshAccessToken()}Q(Qn),this._cache.removeStore(s)}throw new P({code:u.data.code,message:`\u5237\u65B0access token\u5931\u8D25\uFF1A${u.data.code}`})}if(u.data.access_token)return Q(Xn),this._cache.setStore(e,u.data.access_token),this._cache.setStore(t,u.data.access_token_expire+Date.now()),{accessToken:u.data.access_token,accessTokenExpire:u.data.access_token_expire};u.data.refresh_token&&(this._cache.removeStore(s),this._cache.setStore(s,u.data.refresh_token),this._refreshAccessToken())})}getAccessToken(){return A(this,null,function*(){let{accessTokenKey:e,accessTokenExpireKey:t,refreshTokenKey:s}=this._cache.keys;if(!this._cache.getStore(s))throw new P({message:"refresh token\u4E0D\u5B58\u5728\uFF0C\u767B\u5F55\u72B6\u6001\u5F02\u5E38"});let i=this._cache.getStore(e),o=this._cache.getStore(t),a=!0;return this._shouldRefreshAccessTokenHook&&!(yield this._shouldRefreshAccessTokenHook(i,o))&&(a=!1),(!i||!o||o<Date.now())&&a?this.refreshAccessToken():{accessToken:i,accessTokenExpire:o}})}request(e,t,s){return A(this,null,function*(){let i=`x-tcb-trace_${this.config.env}`,o="application/x-www-form-urlencoded",a=N({action:e,env:this.config.env,dataVersion:"2019-08-16"},t);if(hn.indexOf(e)===-1){let{refreshTokenKey:w}=this._cache.keys;this._cache.getStore(w)&&(a.access_token=(yield this.getAccessToken()).accessToken)}let r;if(e==="storage.uploadFile"){r=new FormData;for(let w in r)r.hasOwnProperty(w)&&r[w]!==void 0&&r.append(w,a[w]);o="multipart/form-data"}else{o="application/json",r={};for(let w in a)a[w]!==void 0&&(r[w]=a[w])}let u={headers:{"content-type":o}};s&&s.onUploadProgress&&(u.onUploadProgress=s.onUploadProgress);let c=this._localCache.getStore(i);c&&(u.headers["X-TCB-Trace"]=c);let{parse:y,inQuery:m,search:T}=t,h={env:this.config.env};y&&(h.parse=!0),m&&(h=N(N({},m),h));let g=function(w,I,f={}){let p=/\?/.test(I),_="";for(let v in f)_===""?!p&&(I+="?"):_+="&",_+=`${v}=${encodeURIComponent(f[v])}`;return/^http(s)?\:\/\//.test(I+=_)?I:`${w}${I}`}(ii,"//tcb-api.tencentcloudapi.com/web",h);T&&(g+=T);let d=yield this.post(N({url:g,data:r},u)),l=d.header&&d.header["x-tcb-trace"];if(l&&this._localCache.setStore(i,l),Number(d.status)!==200&&Number(d.statusCode)!==200||!d.data)throw new P({code:"NETWORK_ERROR",message:"network request error"});return d})}send(s){return A(this,arguments,function*(e,t={}){let i=yield this.request(e,t,{onUploadProgress:t.onUploadProgress});if(i.data.code==="ACCESS_TOKEN_EXPIRED"&&hn.indexOf(e)===-1){yield this.refreshAccessToken();let o=yield this.request(e,t,{onUploadProgress:t.onUploadProgress});if(o.data.code)throw new P({code:o.data.code,message:o.data.message});return o.data}if(i.data.code)throw new P({code:i.data.code,message:i.data.message});return i.data})}setRefreshToken(e){let{accessTokenKey:t,accessTokenExpireKey:s,refreshTokenKey:i}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(s),this._cache.setStore(i,e)}},Zn={};function me(n){return Zn[n]}var Me=class{constructor(e){this.config=e,this._cache=ze(e.env),this._request=me(e.env)}setRefreshToken(e){let{accessTokenKey:t,accessTokenExpireKey:s,refreshTokenKey:i}=this._cache.keys;this._cache.removeStore(t),this._cache.removeStore(s),this._cache.setStore(i,e)}setAccessToken(e,t){let{accessTokenKey:s,accessTokenExpireKey:i}=this._cache.keys;this._cache.setStore(s,e),this._cache.setStore(i,t)}refreshUserInfo(){return A(this,null,function*(){let{data:e}=yield this._request.send("auth.getUserInfo",{});return this.setLocalUserInfo(e),e})}setLocalUserInfo(e){let{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e)}},Mt=class{constructor(e){if(!e)throw new P({code:"PARAM_ERROR",message:"envId is not defined"});this._envId=e,this._cache=ze(this._envId),this._request=me(this._envId),this.setUserInfo()}linkWithTicket(e){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"ticket must be string"});return this._request.send("auth.linkWithTicket",{ticket:e})}linkWithRedirect(e){e.signInWithRedirect()}updatePassword(e,t){return this._request.send("auth.updatePassword",{oldPassword:t,newPassword:e})}updateEmail(e){return this._request.send("auth.updateEmail",{newEmail:e})}updateUsername(e){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"username must be a string"});return this._request.send("auth.updateUsername",{username:e})}getLinkedUidList(){return A(this,null,function*(){let{data:e}=yield this._request.send("auth.getLinkedUidList",{}),t=!1,{users:s}=e;return s.forEach(i=>{i.wxOpenId&&i.wxPublicId&&(t=!0)}),{users:s,hasPrimaryUid:t}})}setPrimaryUid(e){return this._request.send("auth.setPrimaryUid",{uid:e})}unlink(e){return this._request.send("auth.unlink",{platform:e})}update(e){return A(this,null,function*(){let{nickName:t,gender:s,avatarUrl:i,province:o,country:a,city:r}=e,{data:u}=yield this._request.send("auth.updateUserInfo",{nickName:t,gender:s,avatarUrl:i,province:o,country:a,city:r});this.setLocalUserInfo(u)})}refresh(){return A(this,null,function*(){let{data:e}=yield this._request.send("auth.getUserInfo",{});return this.setLocalUserInfo(e),e})}setUserInfo(){let{userInfoKey:e}=this._cache.keys,t=this._cache.getStore(e);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl"].forEach(s=>{this[s]=t[s]}),this.location={country:t.country,province:t.province,city:t.city}}setLocalUserInfo(e){let{userInfoKey:t}=this._cache.keys;this._cache.setStore(t,e),this.setUserInfo()}},Se=class{constructor(e){if(!e)throw new P({code:"PARAM_ERROR",message:"envId is not defined"});this._cache=ze(e);let{refreshTokenKey:t,accessTokenKey:s,accessTokenExpireKey:i}=this._cache.keys,o=this._cache.getStore(t),a=this._cache.getStore(s),r=this._cache.getStore(i);this.credential={refreshToken:o,accessToken:a,accessTokenExpire:r},this.user=new Mt(e)}get isAnonymousAuth(){return this.loginType===J.ANONYMOUS}get isCustomAuth(){return this.loginType===J.CUSTOM}get isWeixinAuth(){return this.loginType===J.WECHAT||this.loginType===J.WECHAT_OPEN||this.loginType===J.WECHAT_PUBLIC}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}},je=class extends Me{signIn(){return A(this,null,function*(){this._cache.updatePersistence("local");let{anonymousUuidKey:e,refreshTokenKey:t}=this._cache.keys,s=this._cache.getStore(e)||void 0,i=this._cache.getStore(t)||void 0,o=yield this._request.send("auth.signInAnonymously",{anonymous_uuid:s,refresh_token:i});if(o.uuid&&o.refresh_token){this._setAnonymousUUID(o.uuid),this.setRefreshToken(o.refresh_token),yield this._request.refreshAccessToken(),Q(Oe),Q(ve,{env:this.config.env,loginType:J.ANONYMOUS,persistence:"local"});let a=new Se(this.config.env);return yield a.user.refresh(),a}throw new P({message:"\u533F\u540D\u767B\u5F55\u5931\u8D25"})})}linkAndRetrieveDataWithTicket(e){return A(this,null,function*(){let{anonymousUuidKey:t,refreshTokenKey:s}=this._cache.keys,i=this._cache.getStore(t),o=this._cache.getStore(s),a=yield this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:i,refresh_token:o,ticket:e});if(a.refresh_token)return this._clearAnonymousUUID(),this.setRefreshToken(a.refresh_token),yield this._request.refreshAccessToken(),Q(Lt,{env:this.config.env}),Q(ve,{loginType:J.CUSTOM,persistence:"local"}),{credential:{refreshToken:a.refresh_token}};throw new P({message:"\u533F\u540D\u8F6C\u5316\u5931\u8D25"})})}_setAnonymousUUID(e){let{anonymousUuidKey:t,loginTypeKey:s}=this._cache.keys;this._cache.removeStore(t),this._cache.setStore(t,e),this._cache.setStore(s,J.ANONYMOUS)}_clearAnonymousUUID(){this._cache.removeStore(this._cache.keys.anonymousUuidKey)}},rt=class extends Me{signIn(e){return A(this,null,function*(){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"ticket must be a string"});let{refreshTokenKey:t}=this._cache.keys,s=yield this._request.send("auth.signInWithTicket",{ticket:e,refresh_token:this._cache.getStore(t)||""});if(s.refresh_token)return this.setRefreshToken(s.refresh_token),yield this._request.refreshAccessToken(),Q(Oe),Q(ve,{env:this.config.env,loginType:J.CUSTOM,persistence:this.config.persistence}),yield this.refreshUserInfo(),new Se(this.config.env);throw new P({message:"\u81EA\u5B9A\u4E49\u767B\u5F55\u5931\u8D25"})})}},at=class extends Me{signIn(e,t){return A(this,null,function*(){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"email must be a string"});let{refreshTokenKey:s}=this._cache.keys,i=yield this._request.send("auth.signIn",{loginType:"EMAIL",email:e,password:t,refresh_token:this._cache.getStore(s)||""}),{refresh_token:o,access_token:a,access_token_expire:r}=i;if(o)return this.setRefreshToken(o),a&&r?this.setAccessToken(a,r):yield this._request.refreshAccessToken(),yield this.refreshUserInfo(),Q(Oe),Q(ve,{env:this.config.env,loginType:J.EMAIL,persistence:this.config.persistence}),new Se(this.config.env);throw i.code?new P({code:i.code,message:`\u90AE\u7BB1\u767B\u5F55\u5931\u8D25: ${i.message}`}):new P({message:"\u90AE\u7BB1\u767B\u5F55\u5931\u8D25"})})}activate(e){return A(this,null,function*(){return this._request.send("auth.activateEndUserMail",{token:e})})}resetPasswordWithToken(e,t){return A(this,null,function*(){return this._request.send("auth.resetPasswordWithToken",{token:e,newPassword:t})})}},ct=class extends Me{signIn(e,t){return A(this,null,function*(){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"username must be a string"});typeof t!="string"&&(t="",console.warn("password is empty"));let{refreshTokenKey:s}=this._cache.keys,i=yield this._request.send("auth.signIn",{loginType:J.USERNAME,username:e,password:t,refresh_token:this._cache.getStore(s)||""}),{refresh_token:o,access_token_expire:a,access_token:r}=i;if(o)return this.setRefreshToken(o),r&&a?this.setAccessToken(r,a):yield this._request.refreshAccessToken(),yield this.refreshUserInfo(),Q(Oe),Q(ve,{env:this.config.env,loginType:J.USERNAME,persistence:this.config.persistence}),new Se(this.config.env);throw i.code?new P({code:i.code,message:`\u7528\u6237\u540D\u5BC6\u7801\u767B\u5F55\u5931\u8D25: ${i.message}`}):new P({message:"\u7528\u6237\u540D\u5BC6\u7801\u767B\u5F55\u5931\u8D25"})})}},Et=class{constructor(e){this.config=e,this._cache=ze(e.env),this._request=me(e.env),this._onAnonymousConverted=this._onAnonymousConverted.bind(this),this._onLoginTypeChanged=this._onLoginTypeChanged.bind(this),_e(ve,this._onLoginTypeChanged)}get currentUser(){let e=this.hasLoginState();return e&&e.user||null}get loginType(){return this._cache.getStore(this._cache.keys.loginTypeKey)}anonymousAuthProvider(){return new je(this.config)}customAuthProvider(){return new rt(this.config)}emailAuthProvider(){return new at(this.config)}usernameAuthProvider(){return new ct(this.config)}signInAnonymously(){return A(this,null,function*(){return new je(this.config).signIn()})}signInWithEmailAndPassword(e,t){return A(this,null,function*(){return new at(this.config).signIn(e,t)})}signInWithUsernameAndPassword(e,t){return new ct(this.config).signIn(e,t)}linkAndRetrieveDataWithTicket(e){return A(this,null,function*(){return this._anonymousAuthProvider||(this._anonymousAuthProvider=new je(this.config)),_e(Lt,this._onAnonymousConverted),yield this._anonymousAuthProvider.linkAndRetrieveDataWithTicket(e)})}signOut(){return A(this,null,function*(){if(this.loginType===J.ANONYMOUS)throw new P({message:"\u533F\u540D\u7528\u6237\u4E0D\u652F\u6301\u767B\u51FA\u64CD\u4F5C"});let{refreshTokenKey:e,accessTokenKey:t,accessTokenExpireKey:s}=this._cache.keys,i=this._cache.getStore(e);if(!i)return;let o=yield this._request.send("auth.logout",{refresh_token:i});return this._cache.removeStore(e),this._cache.removeStore(t),this._cache.removeStore(s),Q(Oe),Q(ve,{env:this.config.env,loginType:J.NULL,persistence:this.config.persistence}),o})}signUpWithEmailAndPassword(e,t){return A(this,null,function*(){return this._request.send("auth.signUpWithEmailAndPassword",{email:e,password:t})})}sendPasswordResetEmail(e){return A(this,null,function*(){return this._request.send("auth.sendPasswordResetEmail",{email:e})})}onLoginStateChanged(e){_e(Oe,()=>{let s=this.hasLoginState();e.call(this,s)});let t=this.hasLoginState();e.call(this,t)}onLoginStateExpired(e){_e(Qn,e.bind(this))}onAccessTokenRefreshed(e){_e(Xn,e.bind(this))}onAnonymousConverted(e){_e(Lt,e.bind(this))}onLoginTypeChanged(e){_e(ve,()=>{let t=this.hasLoginState();e.call(this,t)})}getAccessToken(){return A(this,null,function*(){return{accessToken:(yield this._request.getAccessToken()).accessToken,env:this.config.env}})}hasLoginState(){let{refreshTokenKey:e}=this._cache.keys;return this._cache.getStore(e)?new Se(this.config.env):null}isUsernameRegistered(e){return A(this,null,function*(){if(typeof e!="string")throw new P({code:"PARAM_ERROR",message:"username must be a string"});let{data:t}=yield this._request.send("auth.isUsernameRegistered",{username:e});return t&&t.isRegistered})}getLoginState(){return Promise.resolve(this.hasLoginState())}signInWithTicket(e){return A(this,null,function*(){return new rt(this.config).signIn(e)})}shouldRefreshAccessToken(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)}getUserInfo(){return this._request.send("auth.getUserInfo",{}).then(e=>e.code?e:ee(N({},e.data),{requestId:e.seqId}))}getAuthHeader(){let{refreshTokenKey:e,accessTokenKey:t}=this._cache.keys,s=this._cache.getStore(e);return{"x-cloudbase-credentials":this._cache.getStore(t)+"/@@/"+s}}_onAnonymousConverted(e){let{env:t}=e.data;t===this.config.env&&this._cache.updatePersistence(this.config.persistence)}_onLoginTypeChanged(e){let{loginType:t,persistence:s,env:i}=e.data;i===this.config.env&&(this._cache.updatePersistence(s),this._cache.setStore(this._cache.keys.loginTypeKey,t))}},gi=function(n,e){e=e||Je();let t=me(this.config.env),{cloudPath:s,filePath:i,onUploadProgress:o,fileType:a="image"}=n;return t.send("storage.getUploadMetadata",{path:s}).then(r=>{let{data:{url:u,authorization:c,token:y,fileId:m,cosFileId:T},requestId:h}=r,g={key:s,signature:c,"x-cos-meta-fileid":T,success_action_status:"201","x-cos-security-token":y};t.upload({url:u,data:g,file:i,name:s,fileType:a,onUploadProgress:o}).then(d=>{d.statusCode===201?e(null,{fileID:m,requestId:h}):e(new P({code:"STORAGE_REQUEST_FAIL",message:`STORAGE_REQUEST_FAIL: ${d.data}`}))}).catch(d=>{e(d)})}).catch(r=>{e(r)}),e.promise},pi=function(n,e){e=e||Je();let t=me(this.config.env),{cloudPath:s}=n;return t.send("storage.getUploadMetadata",{path:s}).then(i=>{e(null,i)}).catch(i=>{e(i)}),e.promise},mi=function({fileList:n},e){if(e=e||Je(),!n||!Array.isArray(n))return{code:"INVALID_PARAM",message:"fileList\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u6570\u7EC4"};for(let s of n)if(!s||typeof s!="string")return{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u5B57\u7B26\u4E32"};let t={fileid_list:n};return me(this.config.env).send("storage.batchDeleteFile",t).then(s=>{s.code?e(null,s):e(null,{fileList:s.data.delete_list,requestId:s.requestId})}).catch(s=>{e(s)}),e.promise},es=function({fileList:n},e){e=e||Je(),n&&Array.isArray(n)||e(null,{code:"INVALID_PARAM",message:"fileList\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u6570\u7EC4"});let t=[];for(let i of n)typeof i=="object"?(i.hasOwnProperty("fileID")&&i.hasOwnProperty("maxAge")||e(null,{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u5305\u542BfileID\u548CmaxAge\u7684\u5BF9\u8C61"}),t.push({fileid:i.fileID,max_age:i.maxAge})):typeof i=="string"?t.push({fileid:i}):e(null,{code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u5B57\u7B26\u4E32"});let s={file_list:t};return me(this.config.env).send("storage.batchGetDownloadUrl",s).then(i=>{i.code?e(null,i):e(null,{fileList:i.data.download_list,requestId:i.requestId})}).catch(i=>{e(i)}),e.promise},_i=function(t,s){return A(this,arguments,function*({fileID:n},e){let i=(yield es.call(this,{fileList:[{fileID:n,maxAge:600}]})).fileList[0];if(i.code!=="SUCCESS")return e?e(i):new Promise(r=>{r(i)});let o=me(this.config.env),a=i.download_url;if(a=encodeURI(a),!e)return o.download({url:a});e(yield o.download({url:a}))})},yi=function({name:n,data:e,query:t,parse:s,search:i},o){let a=o||Je(),r;try{r=e?JSON.stringify(e):""}catch(c){return Promise.reject(c)}if(!n)return Promise.reject(new P({code:"PARAM_ERROR",message:"\u51FD\u6570\u540D\u4E0D\u80FD\u4E3A\u7A7A"}));let u={inQuery:t,parse:s,search:i,function_name:n,request_data:r};return me(this.config.env).send("functions.invokeFunction",u).then(c=>{if(c.code)a(null,c);else{let y=c.data.response_data;if(s)a(null,{result:y,requestId:c.requestId});else try{y=JSON.parse(c.data.response_data),a(null,{result:y,requestId:c.requestId})}catch(m){a(new P({message:"response data must be json"}))}}return a.promise}).catch(c=>{a(c)}),a.promise},fn={timeout:15e3,persistence:"session"},gn={},Fe=class{constructor(e){this.config=e||this.config,this.authObj=void 0}init(e){switch(z.adapter||(this.requestClient=new z.adapter.reqClass({timeout:e.timeout||5e3,timeoutMsg:`\u8BF7\u6C42\u5728${(e.timeout||5e3)/1e3}s\u5185\u672A\u5B8C\u6210\uFF0C\u5DF2\u4E2D\u65AD`})),this.config=N(N({},fn),e),!0){case this.config.timeout>6e5:console.warn("timeout\u5927\u4E8E\u53EF\u914D\u7F6E\u4E0A\u9650[10\u5206\u949F]\uFF0C\u5DF2\u91CD\u7F6E\u4E3A\u4E0A\u9650\u6570\u503C"),this.config.timeout=6e5;break;case this.config.timeout<100:console.warn("timeout\u5C0F\u4E8E\u53EF\u914D\u7F6E\u4E0B\u9650[100ms]\uFF0C\u5DF2\u91CD\u7F6E\u4E3A\u4E0B\u9650\u6570\u503C"),this.config.timeout=100}return new Fe(this.config)}auth({persistence:e}={}){if(this.authObj)return this.authObj;let t=e||z.adapter.primaryStorage||fn.persistence;var s;return t!==this.config.persistence&&(this.config.persistence=t),function(i){let{env:o}=i;Gn[o]=new it(i),Yn[o]=new it(ee(N({},i),{persistence:"local"}))}(this.config),s=this.config,Zn[s.env]=new Ot(s),this.authObj=new Et(this.config),this.authObj}on(e,t){return _e.apply(this,[e,t])}off(e,t){return hi.apply(this,[e,t])}callFunction(e,t){return yi.apply(this,[e,t])}deleteFile(e,t){return mi.apply(this,[e,t])}getTempFileURL(e,t){return es.apply(this,[e,t])}downloadFile(e,t){return _i.apply(this,[e,t])}uploadFile(e,t){return gi.apply(this,[e,t])}getUploadMetadata(e,t){return pi.apply(this,[e,t])}registerExtension(e){gn[e.name]=e}invokeExtension(e,t){return A(this,null,function*(){let s=gn[e];if(!s)throw new P({message:`\u6269\u5C55${e} \u5FC5\u987B\u5148\u6CE8\u518C`});return yield s.invoke(t,this)})}useAdapters(e){let{adapter:t,runtime:s}=li(e)||{};t&&(z.adapter=t),s&&(z.runtime=s)}},ts=new Fe;function pn(n,e,t){t===void 0&&(t={});var s=/\?/.test(e),i="";for(var o in t)i===""?!s&&(e+="?"):i+="&",i+=o+"="+encodeURIComponent(t[o]);return/^http(s)?:\/\//.test(e+=i)?e:""+n+e}var Dt=class{post(e){let{url:t,data:s,headers:i}=e;return new Promise((o,a)=>{Y.request({url:pn("https:",t),data:s,method:"POST",header:i,success(r){o(r)},fail(r){a(r)}})})}upload(e){return new Promise((t,s)=>{let{url:i,file:o,data:a,headers:r,fileType:u}=e,c=Y.uploadFile({url:pn("https:",i),name:"file",formData:Object.assign({},a),filePath:o,fileType:u,header:r,success(y){let m={statusCode:y.statusCode,data:y.data||{}};y.statusCode===200&&a.success_action_status&&(m.statusCode=parseInt(a.success_action_status,10)),t(m)},fail(y){s(new Error(y.errMsg||"uploadFile:fail"))}});typeof e.onUploadProgress=="function"&&c&&typeof c.onProgressUpdate=="function"&&c.onProgressUpdate(y=>{e.onUploadProgress({loaded:y.totalBytesSent,total:y.totalBytesExpectedToSend})})})}},vi={setItem(n,e){Y.setStorageSync(n,e)},getItem:n=>Y.getStorageSync(n),removeItem(n){Y.removeStorageSync(n)},clear(){Y.clearStorageSync()}},wi={genAdapter:function(){return{root:{},reqClass:Dt,localStorage:vi,primaryStorage:"local"}},isMatch:function(){return!0},runtime:"uni_app"};ts.useAdapters(wi);var Wt=ts,bi=Wt.init;Wt.init=function(n){n.env=n.spaceId;let e=bi.call(this,n);e.config.provider="tencent",e.config.spaceId=n.spaceId;let t=e.auth;return e.auth=function(s){let i=t.call(this,s);return["linkAndRetrieveDataWithTicket","signInAnonymously","signOut","getAccessToken","getLoginState","signInWithTicket","getUserInfo"].forEach(o=>{var a;i[o]=(a=i[o],function(r){r=r||{};let{success:u,fail:c,complete:y}=Hn(r);if(!(u||c||y))return a.call(this,r);a.call(this,r).then(m=>{u&&u(m),y&&y(m)},m=>{c&&c(m),y&&y(m)})}).bind(i)}),i},e.customAuth=e.auth,e};var mn=Wt,Ti=class extends Vn{getAccessToken(){return new Promise((n,e)=>{let t="Anonymous_Access_token";this.setAccessToken(t),n(t)})}setupRequest(n,e){let t=Object.assign({},n,{spaceId:this.config.spaceId,timestamp:Date.now()}),s={"Content-Type":"application/json"};e!=="auth"&&(t.token=this.accessToken,s["x-basement-token"]=this.accessToken),s["x-serverless-sign"]=Ue.sign(t,this.config.clientSecret);let i=zn();s["x-client-info"]=encodeURIComponent(JSON.stringify(i));let{token:o}=ht();return s["x-client-token"]=o,{url:this.config.requestUrl,method:"POST",data:t,dataType:"json",header:JSON.parse(JSON.stringify(s))}}uploadFileToOSS({url:n,formData:e,name:t,filePath:s,fileType:i,onUploadProgress:o}){return new Promise((a,r)=>{let u=this.adapter.uploadFile({url:n,formData:e,name:t,filePath:s,fileType:i,success(c){c&&c.statusCode<400?a(c):r(new P({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))},fail(c){r(new P({code:c.code||"UPLOAD_FAILED",message:c.message||c.errMsg||"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}});typeof o=="function"&&u&&typeof u.onProgressUpdate=="function"&&u.onProgressUpdate(c=>{o({loaded:c.totalBytesSent,total:c.totalBytesExpectedToSend})})})}uploadFile({filePath:n,cloudPath:e,fileType:t="image",onUploadProgress:s}){if(!e)throw new P({code:"CLOUDPATH_REQUIRED",message:"cloudPath\u4E0D\u53EF\u4E3A\u7A7A"});let i;return this.getOSSUploadOptionsFromPath({cloudPath:e}).then(o=>{let{url:a,formData:r,name:u}=o.result;i=o.result.fileUrl;let c={url:a,formData:r,name:u,filePath:n,fileType:t};return this.uploadFileToOSS(Object.assign({},c,{onUploadProgress:s}))}).then(()=>this.reportOSSUpload({cloudPath:e})).then(o=>new Promise((a,r)=>{o.success?a({success:!0,filePath:n,fileID:i}):r(new P({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}))}deleteFile({fileList:n}){let e={method:"serverless.file.resource.delete",params:JSON.stringify({fileList:n})};return this.request(this.setupRequest(e)).then(t=>{if(t.success)return t.result;throw new P({code:"DELETE_FILE_FAILED",message:"\u5220\u9664\u6587\u4EF6\u5931\u8D25"})})}getTempFileURL({fileList:n,maxAge:e}={}){if(!Array.isArray(n)||n.length===0)throw new P({code:"INVALID_PARAM",message:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u5B57\u7B26\u4E32"});let t={method:"serverless.file.resource.getTempFileURL",params:JSON.stringify({fileList:n,maxAge:e})};return this.request(this.setupRequest(t)).then(s=>{if(s.success)return{fileList:s.result.fileList.map(i=>({fileID:i.fileID,tempFileURL:i.tempFileURL}))};throw new P({code:"GET_TEMP_FILE_URL_FAILED",message:"\u83B7\u53D6\u4E34\u65F6\u6587\u4EF6\u94FE\u63A5\u5931\u8D25"})})}},Ii={init(n){let e=new Ti(n),t={signInAnonymously:function(){return e.authorize()},getLoginState:function(){return Promise.resolve(!1)}};return e.auth=function(){return t},e.customAuth=e.auth,e}},St=ue(function(n,e){n.exports=ye.enc.Hex});function ns(n="",e={}){let{data:t,functionName:s,method:i,headers:o,signHeaderKeys:a=[],config:r}=e,u=Date.now(),c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var l=16*Math.random()|0;return(d==="x"?l:3&l|8).toString(16)}),y=Object.assign({},o,{"x-from-app-id":r.spaceAppId,"x-from-env-id":r.spaceId,"x-to-env-id":r.spaceId,"x-from-instance-id":u,"x-from-function-name":s,"x-client-timestamp":u,"x-alipay-source":"client","x-request-id":c,"x-alipay-callid":c}),m=["x-from-app-id","x-from-env-id","x-to-env-id","x-from-instance-id","x-from-function-name","x-client-timestamp"].concat(a),[T="",h=""]=n.split("?")||[],g=function(d){let l=d.signedHeaders.join(";"),w=d.signedHeaders.map(M=>`${M.toLowerCase()}:${d.headers[M]}
`).join(""),I=un(d.body).toString(St),f=`${d.method.toUpperCase()}
${d.path}
${d.query}
${w}
${l}
${I}
`,p=un(f).toString(St),_=`HMAC-SHA256
${d.timestamp}
${p}
`,v=ai(_,d.secretKey).toString(St);return`HMAC-SHA256 Credential=${d.secretId}, SignedHeaders=${l}, Signature=${v}`}({path:T,query:h,method:i,headers:y,timestamp:u,body:JSON.stringify(t),secretId:r.accessKey,secretKey:r.secretKey,signedHeaders:m.sort()});return{url:`${r.endpoint}${n}`,headers:Object.assign({},y,{Authorization:g})}}function ss({url:n,data:e,method:t="POST",headers:s={}}){return new Promise((i,o)=>{Y.request({url:n,method:t,data:e,header:s,dataType:"json",complete:(a={})=>{if(!a.statusCode||a.statusCode>=400){let{errMsg:r}=a.data||{};return o(new P({code:"SYS_ERR",message:r||a.errMsg||"request:fail",requestId:a.requestID}))}i({status:a.statusCode,data:a.data,headers:a.header,requestId:a.requestID})}})})}function _n(n,e){let{path:t,data:s,method:i="GET"}=n,{url:o,headers:a}=ns(t,{functionName:"",data:s,method:i,headers:{"x-alipay-cloud-mode":"oss","x-data-api-type":"oss","x-expire-timestamp":Date.now()+6e4},signHeaderKeys:["x-data-api-type","x-expire-timestamp"],config:e});return ss({url:o,data:s,method:i,headers:a}).then(r=>{let u=r.data||{};if(!u.success)throw new P({code:r.code,message:r.message,requestId:r.trace_id});return u.data||{}}).catch(r=>{throw new P({code:r.errCode,message:r.errMsg,requestId:r.requestId})})}function Si(n=""){let e=n.trim().replace(/^cloud:\/\//,""),t=e.indexOf("/");if(t<=0)throw new P({code:"INVALID_PARAM",message:"fileID\u4E0D\u5408\u6CD5"});let s=e.substring(0,t),i=e.substring(t+1);return s!==this.config.spaceId&&console.warn("file ".concat(n," does not belong to env ").concat(this.config.spaceId)),i}var ki=class{constructor(n){if(["spaceId","spaceAppId","accessKey","secretKey"].forEach(e=>{if(!Object.prototype.hasOwnProperty.call(n,e))throw new Error(`${e} required`)}),n.endpoint){if(typeof n.endpoint!="string")throw new Error("endpoint must be string");if(!/^https:\/\//.test(n.endpoint))throw new Error("endpoint must start with https://");n.endpoint=n.endpoint.replace(/\/$/,"")}this.config=Object.assign({},n,{endpoint:n.endpoint||`https://${n.spaceId}.api-hz.cloudbasefunction.cn`})}callFunction(n){return function(e,t){let{name:s,data:i}=e,o="POST",{url:a,headers:r}=ns("/functions/invokeFunction",{functionName:s,data:i,method:o,headers:{"x-to-function-name":s},signHeaderKeys:["x-to-function-name"],config:t});return ss({url:a,data:i,method:o,headers:r}).then(u=>({errCode:0,success:!0,requestId:u.requestId,result:u.data})).catch(u=>{throw new P({code:u.errCode,message:u.errMsg,requestId:u.requestId})})}(n,this.config)}uploadFileToOSS({url:n,filePath:e,fileType:t,formData:s,onUploadProgress:i}){return new Promise((o,a)=>{let r=Y.uploadFile({url:n,filePath:e,fileType:t,formData:s,name:"file",success(u){u&&u.statusCode<400?o(u):a(new P({code:"UPLOAD_FAILED",message:"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))},fail(u){a(new P({code:u.code||"UPLOAD_FAILED",message:u.message||u.errMsg||"\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}))}});typeof i=="function"&&r&&typeof r.onProgressUpdate=="function"&&r.onProgressUpdate(u=>{i({loaded:u.totalBytesSent,total:u.totalBytesExpectedToSend})})})}uploadFile(i){return A(this,arguments,function*({filePath:n,cloudPath:e="",fileType:t="image",onUploadProgress:s}){if(qe(e)!=="string")throw new P({code:"INVALID_PARAM",message:"cloudPath\u5FC5\u987B\u4E3A\u5B57\u7B26\u4E32\u7C7B\u578B"});if(!(e=e.trim()))throw new P({code:"INVALID_PARAM",message:"cloudPath\u4E0D\u53EF\u4E3A\u7A7A"});if(/:\/\//.test(e))throw new P({code:"INVALID_PARAM",message:"cloudPath\u4E0D\u5408\u6CD5"});let o=yield _n({path:"/".concat(e.replace(/^\//,""),"?post_url")},this.config),{file_id:a,upload_url:r,form_data:u}=o,c=u&&u.reduce((y,m)=>(y[m.key]=m.value,y),{});return this.uploadFileToOSS({url:r,filePath:n,fileType:t,formData:c,onUploadProgress:s}).then(()=>({fileID:a}))})}getTempFileURL(e){return A(this,arguments,function*({fileList:n}){return new Promise((t,s)=>{(!n||n.length<0)&&s(new P({errCode:"INVALID_PARAM",errMsg:"fileList\u4E0D\u80FD\u4E3A\u7A7A\u6570\u7EC4"})),n.length>50&&s(new P({errCode:"INVALID_PARAM",errMsg:"fileList\u6570\u7EC4\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC750"}));let i=[];for(let o of n){qe(o)!=="string"&&s(new P({errCode:"INVALID_PARAM",errMsg:"fileList\u7684\u5143\u7D20\u5FC5\u987B\u662F\u975E\u7A7A\u7684\u5B57\u7B26\u4E32"}));let a=Si.call(this,o);i.push({file_id:a,expire:600})}_n({path:"/?download_url",data:{file_list:i},method:"POST"},this.config).then(o=>{let{file_list:a=[]}=o;t({fileList:a.map(r=>({fileID:r.file_id,tempFileURL:r.download_url}))})}).catch(o=>s(o))})})}},xi={init:n=>{n.provider="alipay";let e=new ki(n);return e.auth=function(){return{signInAnonymously:function(){return Promise.resolve()},getLoginState:function(){return Promise.resolve(!0)}}},e}};function Ai({data:n}){let e;e=zn();let t=JSON.parse(JSON.stringify(n||{}));if(Object.assign(t,{clientInfo:e}),!t.uniIdToken){let{token:s}=ht();s&&(t.uniIdToken=s)}return t}var Pi=[{rule:/fc_function_not_found|FUNCTION_NOT_FOUND/,content:"\uFF0C\u4E91\u51FD\u6570[{functionName}]\u5728\u4E91\u7AEF\u4E0D\u5B58\u5728\uFF0C\u8BF7\u68C0\u67E5\u6B64\u4E91\u51FD\u6570\u540D\u79F0\u662F\u5426\u6B63\u786E\u4EE5\u53CA\u8BE5\u4E91\u51FD\u6570\u662F\u5426\u5DF2\u4E0A\u4F20\u5230\u670D\u52A1\u7A7A\u95F4",mode:"append"}],is=/[\\^$.*+?()[\]{}|]/g,Ci=RegExp(is.source);function yn(n,e,t){return n.replace(new RegExp((s=e)&&Ci.test(s)?s.replace(is,"\\$&"):s,"g"),t);var s}var Li="request",Oi="response",Mi="both",Ei={code:2e4,message:"System error"},Di={code:20101,message:"Invalid client"};function os(n){let{errSubject:e,subject:t,errCode:s,errMsg:i,code:o,message:a,cause:r}=n||{};return new P({subject:e||t||"uni-secure-network",code:s||o||Ei.code,message:i||a,cause:r})}var Rt;function vn({secretType:n}={}){return n===Li||n===Oi||n===Mi}function wn({name:n,data:e={}}={}){return n==="DCloud-clientDB"&&e.redirectTo==="encryption"&&e.action==="getAppClientKey"}function Ri({provider:n,spaceId:e,functionName:t}={}){let{appId:s,uniPlatform:i,osName:o}=Jn(),a=i;i==="app"&&(a=o);let r=function({provider:m,spaceId:T}={}){let h=Qs;if(!h)return{};m=function(d){return d==="tencent"?"tcb":d}(m);let g=h.find(d=>d.provider===m&&d.spaceId===T);return g&&g.config}({provider:n,spaceId:e});if(!r||!r.accessControl||!r.accessControl.enable)return!1;let u=r.accessControl.function||{},c=Object.keys(u);if(c.length===0)return!0;let y=function(m,T){let h,g,d;for(let l=0;l<m.length;l++){let w=m[l];w!==T?w!=="*"?w.split(",").map(I=>I.trim()).indexOf(T)>-1&&(g=w):d=w:h=w}return h||g||d}(c,t);if(!y)return!1;if((u[y]||[]).find((m={})=>m.appId===s&&(m.platform||"").toLowerCase()===a.toLowerCase()))return!0;throw console.error(`\u6B64\u5E94\u7528[appId: ${s}, platform: ${a}]\u4E0D\u5728\u4E91\u7AEF\u914D\u7F6E\u7684\u5141\u8BB8\u8BBF\u95EE\u7684\u5E94\u7528\u5217\u8868\u5185\uFF0C\u53C2\u8003\uFF1Ahttps://uniapp.dcloud.net.cn/uniCloud/secure-network.html#verify-client`),os(Di)}function bn({functionName:n,result:e,logPvd:t}){}function Ui(n){let e=n.callFunction,t=function(s){let i=s.name;s.data=Ai.call(n,{data:s.data});let o={aliyun:"aliyun",tencent:"tcb",tcb:"tcb",alipay:"alipay"}[this.config.provider],a=vn(s),r=wn(s),u=a||r;return e.call(this,s).then(c=>(c.errCode=0,!u&&bn.call(this,{functionName:i,result:c,logPvd:o}),Promise.resolve(c)),c=>(!u&&bn.call(this,{functionName:i,result:c,logPvd:o}),c&&c.message&&(c.message=function({message:y="",extraInfo:m={},formatter:T=[]}={}){for(let h=0;h<T.length;h++){let{rule:g,content:d,mode:l}=T[h],w=y.match(g);if(!w)continue;let I=d;for(let f=1;f<w.length;f++)I=yn(I,`{$${f}}`,w[f]);for(let f in m)I=yn(I,`{${f}}`,m[f]);return l==="replace"?I:y+I}return y}({message:`[${s.name}]: ${c.message}`,formatter:Pi,extraInfo:{functionName:i}})),Promise.reject(c)))};n.callFunction=function(s){let{provider:i,spaceId:o}=n.config,a=s.name,r,u;return s.data=s.data||{},r=t,r=r.bind(n),wn(s)?u=t.call(n,s):vn(s)?u=new Rt({secretType:s.secretType,uniCloudIns:n}).wrapEncryptDataCallFunction(t.bind(n))(s):Ri({provider:i,spaceId:o,functionName:a})?u=new Rt({secretType:s.secretType,uniCloudIns:n}).wrapVerifyClientCallFunction(t.bind(n))(s):u=r(s),Object.defineProperty(u,"result",{get:()=>(console.warn("\u5F53\u524D\u8FD4\u56DE\u7ED3\u679C\u4E3APromise\u7C7B\u578B\uFF0C\u4E0D\u53EF\u76F4\u63A5\u8BBF\u95EE\u5176result\u5C5E\u6027\uFF0C\u8BE6\u60C5\u8BF7\u53C2\u8003\uFF1Ahttps://uniapp.dcloud.net.cn/uniCloud/faq?id=promise"),{})}),u}}Rt=class{constructor(){throw os({message:`Platform ${Bn} is not enabled, please check whether secure network module is enabled in your manifest.json`})}};var rs=Symbol("CLIENT_DB_INTERNAL");function ut(n,e){return n.then="DoNotReturnProxyWithAFunctionNamedThen",n._internalType=rs,n.inspect=null,n.__v_raw=void 0,new Proxy(n,{get(t,s,i){if(s==="_uniClient")return null;if(typeof s=="symbol")return t[s];if(s in t||typeof s!="string"){let o=t[s];return typeof o=="function"?o.bind(t):o}return e.get(t,s,i)}})}function Tn(n){return{on:(e,t)=>{n[e]=n[e]||[],n[e].indexOf(t)>-1||n[e].push(t)},off:(e,t)=>{n[e]=n[e]||[];let s=n[e].indexOf(t);s!==-1&&n[e].splice(s,1)}}}var Ni=["db.Geo","db.command","command.aggregate"];function as(n,e){return Ni.indexOf(`${n}.${e}`)>-1}function Ie(n){switch(qe(n=Wn(n))){case"array":return n.map(e=>Ie(e));case"object":return n._internalType===rs||Object.keys(n).forEach(e=>{n[e]=Ie(n[e])}),n;case"regexp":return{$regexp:{source:n.source,flags:n.flags}};case"date":return{$date:n.toISOString()};default:return n}}function De(n){return n&&n.content&&n.content.$method}var Ut=class{constructor(e,t,s){this.content=e,this.prevStage=t||null,this.udb=null,this._database=s}toJSON(){let e=this,t=[e.content];for(;e.prevStage;)e=e.prevStage,t.push(e.content);return{$db:t.reverse().map(s=>({$method:s.$method,$param:Ie(s.$param)}))}}toString(){return JSON.stringify(this.toJSON())}getAction(){let e=this.toJSON().$db.find(t=>t.$method==="action");return e&&e.$param&&e.$param[0]}getCommand(){return{$db:this.toJSON().$db.filter(e=>e.$method!=="action")}}get isAggregate(){let e=this;for(;e;){let t=De(e),s=De(e.prevStage);if(t==="aggregate"&&s==="collection"||t==="pipeline")return!0;e=e.prevStage}return!1}get isCommand(){let e=this;for(;e;){if(De(e)==="command")return!0;e=e.prevStage}return!1}get isAggregateCommand(){let e=this;for(;e;){let t=De(e),s=De(e.prevStage);if(t==="aggregate"&&s==="command")return!0;e=e.prevStage}return!1}getNextStageFn(e){let t=this;return function(){return $e({$method:e,$param:Ie(Array.from(arguments))},t,t._database)}}get count(){return this.isAggregate?this.getNextStageFn("count"):function(){return this._send("count",Array.from(arguments))}}get remove(){return this.isCommand?this.getNextStageFn("remove"):function(){return this._send("remove",Array.from(arguments))}}get(){return this._send("get",Array.from(arguments))}get add(){return this.isCommand?this.getNextStageFn("add"):function(){return this._send("add",Array.from(arguments))}}update(){return this._send("update",Array.from(arguments))}end(){return this._send("end",Array.from(arguments))}get set(){return this.isCommand?this.getNextStageFn("set"):function(){throw new Error("JQL\u7981\u6B62\u4F7F\u7528set\u65B9\u6CD5")}}_send(e,t){let s=this.getAction(),i=this.getCommand();return i.$db.push({$method:e,$param:Ie(t)}),this._database._callCloudFunction({action:s,command:i})}};function $e(n,e,t){return ut(new Ut(n,e,t),{get(s,i){let o="db";return s&&s.content&&(o=s.content.$method),as(o,i)?$e({$method:i},s,t):function(){return $e({$method:i,$param:Ie(Array.from(arguments))},s,t)}}})}function kt({path:n,method:e}){return class{constructor(){this.param=Array.from(arguments)}toJSON(){return{$newDb:[...n.map(t=>({$method:t})),{$method:e,$param:this.param}]}}toString(){return JSON.stringify(this.toJSON())}}}function In(n,e={}){return ut(new n(e),{get:(t,s)=>as("db",s)?$e({$method:s},null,t):function(){return $e({$method:s,$param:Ie(Array.from(arguments))},null,t)}})}var lt=class extends class{constructor({uniClient:e={},isJQL:t=!1}={}){this._uniClient=e,this._authCallBacks={},this._dbCallBacks={},e._isDefault&&(this._dbCallBacks=Ce("_globalUniCloudDatabaseCallback")),t||(this.auth=Tn(this._authCallBacks)),this._isJQL=t,Object.assign(this,Tn(this._dbCallBacks)),this.env=ut({},{get:(s,i)=>({$env:i})}),this.Geo=ut({},{get:(s,i)=>kt({path:["Geo"],method:i})}),this.serverDate=kt({path:[],method:"serverDate"}),this.RegExp=kt({path:[],method:"RegExp"})}getCloudEnv(e){if(typeof e!="string"||!e.trim())throw new Error("getCloudEnv\u53C2\u6570\u9519\u8BEF");return{$env:e.replace("$cloudEnv_","")}}_callback(e,t){let s=this._dbCallBacks;s[e]&&s[e].forEach(i=>{i(...t)})}_callbackAuth(e,t){let s=this._authCallBacks;s[e]&&s[e].forEach(i=>{i(...t)})}multiSend(){let e=Array.from(arguments),t=e.map(s=>{let i=s.getAction(),o=s.getCommand();if(o.$db[o.$db.length-1].$method!=="getTemp")throw new Error("multiSend\u53EA\u652F\u6301\u5B50\u547D\u4EE4\u5185\u4F7F\u7528getTemp");return{action:i,command:o}});return this._callCloudFunction({multiCommand:t,queryList:e})}}{_parseResult(e){return this._isJQL?e.result:e}_callCloudFunction({action:e,command:t,multiCommand:s,queryList:i}){function o(m,T){if(s&&i)for(let h=0;h<i.length;h++){let g=i[h];g.udb&&typeof g.udb.setResult=="function"&&(T?g.udb.setResult(T):g.udb.setResult(m.result.dataList[h]))}}let a=this,r=this._isJQL?"databaseForJQL":"database";function u(m){return a._callback("error",[m]),V(G(r,"fail"),m).then(()=>V(G(r,"complete"),m)).then(()=>(o(null,m),se(ce,{type:rn,content:m}),Promise.reject(m)))}let c=V(G(r,"invoke")),y=this._uniClient;return c.then(()=>y.callFunction({name:"DCloud-clientDB",type:Js,data:{action:e,command:t,multiCommand:s}})).then(m=>{let{code:T,message:h,token:g,tokenExpired:d,systemInfo:l=[]}=m.result;if(l)for(let I=0;I<l.length;I++){let{level:f,message:p,detail:_}=l[I],v=console[f==="warn"?"error":f]||console.log,M="[System Info]"+p;_&&(M=`${M}
\u8BE6\u7EC6\u4FE1\u606F\uFF1A${_}`),v(M)}if(T)return u(new P({code:T,message:h,requestId:m.requestId}));m.result.errCode=m.result.errCode||m.result.code,m.result.errMsg=m.result.errMsg||m.result.message,g&&d&&(Kn({token:g,tokenExpired:d}),this._callbackAuth("refreshToken",[{token:g,tokenExpired:d}]),this._callback("refreshToken",[{token:g,tokenExpired:d}]),se(st,{token:g,tokenExpired:d}));let w=[{prop:"affectedDocs",tips:"affectedDocs\u4E0D\u518D\u63A8\u8350\u4F7F\u7528\uFF0C\u8BF7\u4F7F\u7528inserted/deleted/updated/data.length\u66FF\u4EE3"},{prop:"code",tips:"code\u4E0D\u518D\u63A8\u8350\u4F7F\u7528\uFF0C\u8BF7\u4F7F\u7528errCode\u66FF\u4EE3"},{prop:"message",tips:"message\u4E0D\u518D\u63A8\u8350\u4F7F\u7528\uFF0C\u8BF7\u4F7F\u7528errMsg\u66FF\u4EE3"}];for(let I=0;I<w.length;I++){let{prop:f,tips:p}=w[I];if(f in m.result){let _=m.result[f];Object.defineProperty(m.result,f,{get:()=>(console.warn(p),_)})}}return function(I){return V(G(r,"success"),I).then(()=>V(G(r,"complete"),I)).then(()=>{o(I,null);let f=a._parseResult(I);return se(ce,{type:rn,content:f}),Promise.resolve(f)})}(m)},m=>(/fc_function_not_found|FUNCTION_NOT_FOUND/g.test(m.message)&&console.warn("clientDB\u672A\u521D\u59CB\u5316\uFF0C\u8BF7\u5728web\u63A7\u5236\u53F0\u4FDD\u5B58\u4E00\u6B21schema\u4EE5\u5F00\u542FclientDB"),u(new P({code:m.code||"SYSTEM_ERROR",message:m.message,requestId:m.requestId}))))}},Te="token\u65E0\u6548\uFF0C\u8DF3\u8F6C\u767B\u5F55\u9875\u9762",cs="token\u8FC7\u671F\uFF0C\u8DF3\u8F6C\u767B\u5F55\u9875\u9762",ji={TOKEN_INVALID_TOKEN_EXPIRED:cs,TOKEN_INVALID_INVALID_CLIENTID:Te,TOKEN_INVALID:Te,TOKEN_INVALID_WRONG_TOKEN:Te,TOKEN_INVALID_ANONYMOUS_USER:Te},Nt={"uni-id-token-expired":cs,"uni-id-check-token-failed":Te,"uni-id-token-not-exist":Te,"uni-id-check-device-feature-failed":Te};function Sn(n,e){let t="";return t=n?`${n}/${e}`:e,t.replace(/^\//,"")}function kn(n=[],e=""){let t=[],s=[];return n.forEach(i=>{i.needLogin===!0?t.push(Sn(e,i.path)):i.needLogin===!1&&s.push(Sn(e,i.path))}),{needLoginPage:t,notNeedLoginPage:s}}function He(n){return n.split("?")[0].replace(/^\//,"")}function Kt(){return function(n){let e=n&&n.$page&&n.$page.fullPath||"";return e&&(e.charAt(0)!=="/"&&(e="/"+e),e)}(function(){let n=getCurrentPages();return n[n.length-1]}())}function us(){return He(Kt())}function Bi(n="",e={}){if(!n||!(e&&e.list&&e.list.length))return!1;let t=e.list,s=He(n);return t.some(i=>i.pagePath===s)}var qi=!!Pe.uniIdRouter,{loginPage:We,routerNeedLogin:Fi,resToLogin:$i,needLoginPage:ls,notNeedLoginPage:Hi,loginPageInTabBar:Wi}=function({pages:n=[],subPackages:e=[],uniIdRouter:t={},tabBar:s={}}=Pe){let{loginPage:i,needLogin:o=[],resToLogin:a=!0}=t,{needLoginPage:r,notNeedLoginPage:u}=kn(n),{needLoginPage:c,notNeedLoginPage:y}=function(m=[]){let T=[],h=[];return m.forEach(g=>{let{root:d,pages:l=[]}=g,{needLoginPage:w,notNeedLoginPage:I}=kn(l,d);T.push(...w),h.push(...I)}),{needLoginPage:T,notNeedLoginPage:h}}(e);return{loginPage:i,routerNeedLogin:o,resToLogin:a,needLoginPage:[...r,...c],notNeedLoginPage:[...u,...y],loginPageInTabBar:Bi(i,s)}}();if(ls.indexOf(We)>-1)throw new Error(`Login page [${We}] should not be "needLogin", please check your pages.json`);function ds(n){let e=us();if(n.charAt(0)==="/")return n;let[t,s]=n.split("?"),i=t.replace(/^\//,"").split("/"),o=e.split("/");o.pop();for(let a=0;a<i.length;a++){let r=i[a];r===".."?o.pop():r!=="."&&o.push(r)}return o[0]===""&&o.shift(),"/"+o.join("/")+(s?"?"+s:"")}function Ki(n){let e=He(ds(n));return!(Hi.indexOf(e)>-1)&&(ls.indexOf(e)>-1||Fi.some(t=>function(s,i){return new RegExp(i).test(s)}(n,t)))}function hs({redirect:n}){let e=He(n),t=He(We);return us()!==t&&e!==t}function jt({api:n,redirect:e}={}){if(!e||!hs({redirect:e}))return;let t=function(i,o){return i.charAt(0)!=="/"&&(i="/"+i),o?i.indexOf("?")>-1?i+`&uniIdRedirectUrl=${encodeURIComponent(o)}`:i+`?uniIdRedirectUrl=${encodeURIComponent(o)}`:i}(We,e);Wi?n!=="navigateTo"&&n!=="redirectTo"||(n="switchTab"):n==="switchTab"&&(n="navigateTo");let s={navigateTo:uni.navigateTo,redirectTo:uni.redirectTo,switchTab:uni.switchTab,reLaunch:uni.reLaunch};setTimeout(()=>{s[n]({url:t})})}function xn({url:n}={}){let e={abortLoginPageJump:!1,autoToLoginPage:!1},t=function(){let{token:s,tokenExpired:i}=ht(),o;if(s){if(i<Date.now()){let a="uni-id-token-expired";o={errCode:a,errMsg:Nt[a]}}}else{let a="uni-id-check-token-failed";o={errCode:a,errMsg:Nt[a]}}return o}();if(Ki(n)&&t){if(t.uniIdRedirectUrl=n,Ke(Le).length>0)return setTimeout(()=>{se(Le,t)},0),e.abortLoginPageJump=!0,e;e.autoToLoginPage=!0}return e}function Ji(){(function(){let e=Kt(),{abortLoginPageJump:t,autoToLoginPage:s}=xn({url:e});t||s&&jt({api:"redirectTo",redirect:e})})();let n=["navigateTo","redirectTo","reLaunch","switchTab"];for(let e=0;e<n.length;e++){let t=n[e];uni.addInterceptor(t,{invoke(s){let{abortLoginPageJump:i,autoToLoginPage:o}=xn({url:s.url});return i?s:o?(jt({api:t,redirect:ds(s.url)}),!1):s}})}}function zi(){this.onResponse(n=>{let{type:e,content:t}=n,s=!1;switch(e){case"cloudobject":s=function(i){if(typeof i!="object")return!1;let{errCode:o}=i||{};return o in Nt}(t);break;case"clientdb":s=function(i){if(typeof i!="object")return!1;let{errCode:o}=i||{};return o in ji}(t)}s&&function(i={}){let o=Ke(Le);$n().then(()=>{let a=Kt();if(a&&hs({redirect:a}))return o.length>0?se(Le,Object.assign({uniIdRedirectUrl:a},i)):void(We&&jt({api:"navigateTo",redirect:a}))})}(t)})}function Vi(n){(function(e){e.onResponse=function(t){_t(ce,t)},e.offResponse=function(t){yt(ce,t)}})(n),function(e){e.onNeedLogin=function(t){_t(Le,t)},e.offNeedLogin=function(t){yt(Le,t)},qi&&(Ce("_globalUniCloudStatus").needLoginInit||(Ce("_globalUniCloudStatus").needLoginInit=!0,$n().then(()=>{Ji.call(e)}),$i&&zi.call(e)))}(n),function(e){e.onRefreshToken=function(t){_t(st,t)},e.offRefreshToken=function(t){yt(st,t)}}(n)}var fs,Qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Gi=/^(?:[A-Za-z\d+/]{4})*?(?:[A-Za-z\d+/]{2}(?:==)?|[A-Za-z\d+/]{3}=?)?$/;function Yi(){let n=ht().token||"",e=n.split(".");if(!n||e.length!==3)return{uid:null,role:[],permission:[],tokenExpired:0};let t;try{t=JSON.parse((s=e[1],decodeURIComponent(fs(s).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""))))}catch(i){throw new Error("\u83B7\u53D6\u5F53\u524D\u7528\u6237\u4FE1\u606F\u51FA\u9519\uFF0C\u8BE6\u7EC6\u9519\u8BEF\u4FE1\u606F\u4E3A\uFF1A"+i.message)}var s;return t.tokenExpired=1e3*t.exp,delete t.exp,delete t.iat,t}fs=typeof atob!="function"?function(n){if(n=String(n).replace(/[\t\n\f\r ]+/g,""),!Gi.test(n))throw new Error("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");var e;n+="==".slice(2-(3&n.length));for(var t,s,i="",o=0;o<n.length;)e=Qe.indexOf(n.charAt(o++))<<18|Qe.indexOf(n.charAt(o++))<<12|(t=Qe.indexOf(n.charAt(o++)))<<6|(s=Qe.indexOf(n.charAt(o++))),i+=t===64?String.fromCharCode(e>>16&255):s===64?String.fromCharCode(e>>16&255,e>>8&255):String.fromCharCode(e>>16&255,e>>8&255,255&e);return i}:atob;var Qi=ue(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});let t="chooseAndUploadFile:ok",s="chooseAndUploadFile:fail";function i(a,r){return a.tempFiles.forEach((u,c)=>{u.name||(u.name=u.path.substring(u.path.lastIndexOf("/")+1)),r&&(u.fileType=r),u.cloudPath=Date.now()+"_"+c+u.name.substring(u.name.lastIndexOf("."))}),a.tempFilePaths||(a.tempFilePaths=a.tempFiles.map(u=>u.path)),a}function o(a,r,{onChooseFile:u,onUploadProgress:c}){return r.then(y=>{if(u){let m=u(y);if(m!==void 0)return Promise.resolve(m).then(T=>T===void 0?y:T)}return y}).then(y=>y===!1?{errMsg:t,tempFilePaths:[],tempFiles:[]}:function(m,T,h=5,g){(T=Object.assign({},T)).errMsg=t;let d=T.tempFiles,l=d.length,w=0;return new Promise(I=>{for(;w<h;)f();function f(){let p=w++;if(p>=l)return void(!d.find(v=>!v.url&&!v.errMsg)&&I(T));let _=d[p];m.uploadFile({filePath:_.path,cloudPath:_.cloudPath,fileType:_.fileType,cloudPathAsRealPath:_.cloudPathAsRealPath,onUploadProgress(v){v.index=p,v.tempFile=_,v.tempFilePath=_.path,g&&g(v)}}).then(v=>{_.url=v.fileID,p<l&&f()}).catch(v=>{_.errMsg=v.errMsg||v.message,p<l&&f()})}})}(a,y,5,c))}e.initChooseAndUploadFile=function(a){return function(r={type:"all"}){return r.type==="image"?o(a,function(u){let{count:c,sizeType:y,sourceType:m=["album","camera"],extension:T}=u;return new Promise((h,g)=>{uni.chooseImage({count:c,sizeType:y,sourceType:m,extension:T,success(d){h(i(d,"image"))},fail(d){g({errMsg:d.errMsg.replace("chooseImage:fail",s)})}})})}(r),r):r.type==="video"?o(a,function(u){let{camera:c,compressed:y,maxDuration:m,sourceType:T=["album","camera"],extension:h}=u;return new Promise((g,d)=>{uni.chooseVideo({camera:c,compressed:y,maxDuration:m,sourceType:T,extension:h,success(l){let{tempFilePath:w,duration:I,size:f,height:p,width:_}=l;g(i({errMsg:"chooseVideo:ok",tempFilePaths:[w],tempFiles:[{name:l.tempFile&&l.tempFile.name||"",path:w,size:f,type:l.tempFile&&l.tempFile.type||"",width:_,height:p,duration:I,fileType:"video",cloudPath:""}]},"video"))},fail(l){d({errMsg:l.errMsg.replace("chooseVideo:fail",s)})}})})}(r),r):o(a,function(u){let{count:c,extension:y}=u;return new Promise((m,T)=>{let h=uni.chooseFile;if(typeof wx!="undefined"&&typeof wx.chooseMessageFile=="function"&&(h=wx.chooseMessageFile),typeof h!="function")return T({errMsg:s+" \u8BF7\u6307\u5B9A type \u7C7B\u578B\uFF0C\u8BE5\u5E73\u53F0\u4EC5\u652F\u6301\u9009\u62E9 image \u6216 video\u3002"});h({type:"all",count:c,extension:y,success(g){m(i(g))},fail(g){T({errMsg:g.errMsg.replace("chooseFile:fail",s)})}})})}(r),r)}}}),Xi=qs(Qi),Zi="manual";function gs(n){return{props:{localdata:{type:Array,default:()=>[]},options:{type:[Object,Array],default:()=>({})},spaceInfo:{type:Object,default:()=>({})},collection:{type:[String,Array],default:""},action:{type:String,default:""},field:{type:String,default:""},orderby:{type:String,default:""},where:{type:[String,Object],default:""},pageData:{type:String,default:"add"},pageCurrent:{type:Number,default:1},pageSize:{type:Number,default:20},getcount:{type:[Boolean,String],default:!1},gettree:{type:[Boolean,String],default:!1},gettreepath:{type:[Boolean,String],default:!1},startwith:{type:String,default:""},limitlevel:{type:Number,default:10},groupby:{type:String,default:""},groupField:{type:String,default:""},distinct:{type:[Boolean,String],default:!1},foreignKey:{type:String,default:""},loadtime:{type:String,default:"auto"},manual:{type:Boolean,default:!1}},data:()=>({mixinDatacomLoading:!1,mixinDatacomHasMore:!1,mixinDatacomResData:[],mixinDatacomErrorMessage:"",mixinDatacomPage:{}}),created(){this.mixinDatacomPage={current:this.pageCurrent,size:this.pageSize,count:0},this.$watch(()=>{var e=[];return["pageCurrent","pageSize","localdata","collection","action","field","orderby","where","getont","getcount","gettree","groupby","groupField","distinct"].forEach(t=>{e.push(this[t])}),e},(e,t)=>{if(this.loadtime===Zi)return;let s=!1,i=[];for(let o=2;o<e.length;o++)e[o]!==t[o]&&(i.push(e[o]),s=!0);e[0]!==t[0]&&(this.mixinDatacomPage.current=this.pageCurrent),this.mixinDatacomPage.size=this.pageSize,this.onMixinDatacomPropsChange(s,i)})},methods:{onMixinDatacomPropsChange(e,t){},mixinDatacomEasyGet({getone:e=!1,success:t,fail:s}={}){this.mixinDatacomLoading||(this.mixinDatacomLoading=!0,this.mixinDatacomErrorMessage="",this.mixinDatacomGet().then(i=>{this.mixinDatacomLoading=!1;let{data:o,count:a}=i.result;this.getcount&&(this.mixinDatacomPage.count=a),this.mixinDatacomHasMore=o.length<this.pageSize;let r=e?o.length?o[0]:void 0:o;this.mixinDatacomResData=r,t&&t(r)}).catch(i=>{this.mixinDatacomLoading=!1,this.mixinDatacomErrorMessage=i,s&&s(i)}))},mixinDatacomGet(e={}){let t=n.database(this.spaceInfo),s=e.action||this.action;s&&(t=t.action(s));let i=e.collection||this.collection;t=Array.isArray(i)?t.collection(...i):t.collection(i);let o=e.where||this.where;o&&Object.keys(o).length&&(t=t.where(o));let a=e.field||this.field;a&&(t=t.field(a));let r=e.foreignKey||this.foreignKey;r&&(t=t.foreignKey(r));let u=e.groupby||this.groupby;u&&(t=t.groupBy(u));let c=e.groupField||this.groupField;c&&(t=t.groupField(c)),(e.distinct!==void 0?e.distinct:this.distinct)===!0&&(t=t.distinct());let y=e.orderby||this.orderby;y&&(t=t.orderBy(y));let m=e.pageCurrent!==void 0?e.pageCurrent:this.mixinDatacomPage.current,T=e.pageSize!==void 0?e.pageSize:this.mixinDatacomPage.size,h=e.getcount!==void 0?e.getcount:this.getcount,g=e.gettree!==void 0?e.gettree:this.gettree,d=e.gettreepath!==void 0?e.gettreepath:this.gettreepath,l={getCount:h},w={limitLevel:e.limitlevel!==void 0?e.limitlevel:this.limitlevel,startWith:e.startwith!==void 0?e.startwith:this.startwith};return g&&(l.getTree=w),d&&(l.getTreePath=w),t=t.skip(T*(m-1)).limit(T).get(l),t}}}}function eo(n){return function(e,t={}){t=function(u,c={}){return u.customUI=c.customUI||u.customUI,u.parseSystemError=c.parseSystemError||u.parseSystemError,Object.assign(u.loadingOptions,c.loadingOptions),Object.assign(u.errorOptions,c.errorOptions),typeof c.secretMethods=="object"&&(u.secretMethods=c.secretMethods),u}({customUI:!1,loadingOptions:{title:"\u52A0\u8F7D\u4E2D...",mask:!0},errorOptions:{type:"modal",retry:!1}},t);let{customUI:s,loadingOptions:i,errorOptions:o,parseSystemError:a}=t,r=!s;return new Proxy({},{get:(u,c)=>function({fn:y,interceptorName:m,getCallbackArgs:T}={}){return function(...h){return A(this,null,function*(){let g=T?T({params:h}):{},d,l;try{return yield V(G(m,"invoke"),N({},g)),d=yield y(...h),yield V(G(m,"success"),ee(N({},g),{result:d})),d}catch(w){throw l=w,yield V(G(m,"fail"),ee(N({},g),{error:l})),l}finally{yield V(G(m,"complete"),l?ee(N({},g),{error:l}):ee(N({},g),{result:d}))}})}}({fn:function y(...m){return A(this,null,function*(){let T;r&&uni.showLoading({title:i.title,mask:i.mask});let h={name:e,type:Ks,data:{method:c,params:m}};typeof t.secretMethods=="object"&&function(f,p){let _=p.data.method,v=f.secretMethods||{},M=v[_]||v["*"];M&&(p.secretType=M)}(t,h);let g=!1;try{T=yield n.callFunction(h)}catch(f){g=!0,T={result:new P(f)}}let{errSubject:d,errCode:l,errMsg:w,newToken:I}=T.result||{};if(r&&uni.hideLoading(),I&&I.token&&I.tokenExpired&&(Kn(I),se(st,N({},I))),l){let f=w;if(g&&a&&(f=(yield a({objectName:e,methodName:c,params:m,errSubject:d,errCode:l,errMsg:w})).errMsg||w),r)if(o.type==="toast")uni.showToast({title:f,icon:"none"});else{if(o.type!=="modal")throw new Error(`Invalid errorOptions.type: ${o.type}`);{let{confirm:_}=yield function(){return A(this,arguments,function*({title:v,content:M,showCancel:E,cancelText:q,confirmText:X}={}){return new Promise((H,te)=>{uni.showModal({title:v,content:M,showCancel:E,cancelText:q,confirmText:X,success(Z){H(Z)},fail(){H({confirm:!1,cancel:!0})}})})})}({title:"\u63D0\u793A",content:f,showCancel:o.retry,cancelText:"\u53D6\u6D88",confirmText:o.retry?"\u91CD\u8BD5":"\u786E\u5B9A"});if(o.retry&&_)return y(...m)}}let p=new P({subject:d,code:l,message:w,requestId:T.requestId});throw p.detail=T.result,se(ce,{type:an,content:p}),p}return se(ce,{type:an,content:T.result}),T.result})},interceptorName:"callObject",getCallbackArgs:function({params:y}={}){return{objectName:e,methodName:c,params:y}}})})}}function ps(n){return Ce("_globalUniCloudSecureNetworkCache__{spaceId}".replace("{spaceId}",n.config.spaceId))}function to(){return A(this,arguments,function*({openid:n,callLoginByWeixin:e=!1}={}){throw ps(this),new Error(`[SecureNetwork] API \`initSecureNetworkByWeixin\` is not supported on platform \`${Bn}\``)})}function no(n){return A(this,null,function*(){let e=ps(this);return e.initPromise||(e.initPromise=to.call(this,n)),e.initPromise})}function so(n){return function({openid:e,callLoginByWeixin:t=!1}={}){return no.call(n,{openid:e,callLoginByWeixin:t})}}function An(n){let e={getSystemInfo:uni.getSystemInfo,getPushClientId:uni.getPushClientId};return function(t){return new Promise((s,i)=>{e[n](ee(N({},t),{success(o){s(o)},fail(o){i(o)}}))})}}var Bt=class extends class{constructor(){this._callback={}}addListener(e,t){this._callback[e]||(this._callback[e]=[]),this._callback[e].push(t)}on(e,t){return this.addListener(e,t)}removeListener(e,t){if(!t)throw new Error('The "listener" argument must be of type function. Received undefined');let s=this._callback[e];if(!s)return;let i=function(o,a){for(let r=o.length-1;r>=0;r--)if(o[r]===a)return r;return-1}(s,t);s.splice(i,1)}off(e,t){return this.removeListener(e,t)}removeAllListener(e){delete this._callback[e]}emit(e,...t){let s=this._callback[e];if(s)for(let i=0;i<s.length;i++)s[i](...t)}}{constructor(){super(),this._uniPushMessageCallback=this._receivePushMessage.bind(this),this._currentMessageId=-1,this._payloadQueue=[]}init(){return Promise.all([An("getSystemInfo")(),An("getPushClientId")()]).then(([{appId:e}={},{cid:t}={}]=[])=>{if(!e)throw new Error("Invalid appId, please check the manifest.json file");if(!t)throw new Error("Invalid push client id");this._appId=e,this._pushClientId=t,this._seqId=Date.now()+"-"+Math.floor(9e5*Math.random()+1e5),this.emit("open"),this._initMessageListener()},e=>{throw this.emit("error",e),this.close(),e})}open(){return A(this,null,function*(){return this.init()})}_isUniCloudSSE(e){if(e.type!=="receive")return!1;let t=e&&e.data&&e.data.payload;return!(!t||t.channel!=="UNI_CLOUD_SSE"||t.seqId!==this._seqId)}_receivePushMessage(e){if(!this._isUniCloudSSE(e))return;let t=e&&e.data&&e.data.payload,{action:s,messageId:i,message:o}=t;this._payloadQueue.push({action:s,messageId:i,message:o}),this._consumMessage()}_consumMessage(){for(;;){let e=this._payloadQueue.find(t=>t.messageId===this._currentMessageId+1);if(!e)break;this._currentMessageId++,this._parseMessagePayload(e)}}_parseMessagePayload(e){let{action:t,messageId:s,message:i}=e;t==="end"?this._end({messageId:s,message:i}):t==="message"&&this._appendMessage({messageId:s,message:i})}_appendMessage({messageId:e,message:t}={}){this.emit("message",t)}_end({messageId:e,message:t}={}){this.emit("end",t),this.close()}_initMessageListener(){uni.onPushMessage(this._uniPushMessageCallback)}_destroy(){uni.offPushMessage(this._uniPushMessageCallback)}toJSON(){return{appId:this._appId,pushClientId:this._pushClientId,seqId:this._seqId}}close(){this._destroy(),this.emit("close")}};function io(n){n._initPromiseHub||(n._initPromiseHub=new nt({createPromise:function(){let e=Promise.resolve();var t;t=1,e=new Promise(i=>{setTimeout(()=>{i()},t)});let s=n.auth();return e.then(()=>s.getLoginState()).then(i=>i?Promise.resolve():s.signInAnonymously())}}))}var oo={tcb:mn,tencent:mn,aliyun:si,private:Ii,alipay:xi},re=new class{init(n){let e={},t=oo[n.provider];if(!t)throw new Error("\u672A\u63D0\u4F9B\u6B63\u786E\u7684provider\u53C2\u6570");return e=t.init(n),io(e),Ui(e),function(s){let i=s.uploadFile;s.uploadFile=function(o){return i.call(this,o)}}(e),function(s){s.database=function(i){if(i&&Object.keys(i).length>0)return s.init(i).database();if(this._database)return this._database;let o=In(lt,{uniClient:s});return this._database=o,o},s.databaseForJQL=function(i){if(i&&Object.keys(i).length>0)return s.init(i).databaseForJQL();if(this._databaseForJQL)return this._databaseForJQL;let o=In(lt,{uniClient:s,isJQL:!0});return this._databaseForJQL=o,o}}(e),function(s){s.getCurrentUserInfo=Yi,s.chooseAndUploadFile=Xi.initChooseAndUploadFile(s),Object.assign(s,{get mixinDatacom(){return gs(s)}}),s.SSEChannel=Bt,s.initSecureNetworkByWeixin=so(s),s.importObject=eo(s)}(e),["callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","chooseAndUploadFile"].forEach(s=>{if(!e[s])return;let i=e[s];e[s]=function(){return i.apply(e,Array.from(arguments))},e[s]=function(o,a){return function(r){let u=!1;a==="callFunction"&&(u=(r&&r.type||tn)!==tn);let c=a==="callFunction"&&!u,y=this._initPromiseHub.exec();r=r||{};let{success:m,fail:T,complete:h}=Hn(r),g=y.then(()=>u?Promise.resolve():V(G(a,"invoke"),r)).then(()=>o.call(this,r)).then(d=>u?Promise.resolve(d):V(G(a,"success"),d).then(()=>V(G(a,"complete"),d)).then(()=>(c&&se(ce,{type:Ge,content:d}),Promise.resolve(d))),d=>u?Promise.reject(d):V(G(a,"fail"),d).then(()=>V(G(a,"complete"),d)).then(()=>(se(ce,{type:Ge,content:d}),Promise.reject(d))));if(!(m||T||h))return g;g.then(d=>{m&&m(d),h&&h(d),c&&se(ce,{type:Ge,content:d})},d=>{T&&T(d),h&&h(d),c&&se(ce,{type:Ge,content:d})})}}(e[s],s).bind(e)}),e.init=this.init,e}};(()=>{let n=Xs,e={};if(n&&n.length===1)e=n[0],re=re.init(e),re._isDefault=!0;else{let t=["auth","callFunction","uploadFile","deleteFile","getTempFileURL","downloadFile","database","getCurrentUSerInfo","importObject"],s;s=n&&n.length>0?"\u5E94\u7528\u6709\u591A\u4E2A\u670D\u52A1\u7A7A\u95F4\uFF0C\u8BF7\u901A\u8FC7uniCloud.init\u65B9\u6CD5\u6307\u5B9A\u8981\u4F7F\u7528\u7684\u670D\u52A1\u7A7A\u95F4":"\u5E94\u7528\u672A\u5173\u8054\u670D\u52A1\u7A7A\u95F4\uFF0C\u8BF7\u5728uniCloud\u76EE\u5F55\u53F3\u952E\u5173\u8054\u670D\u52A1\u7A7A\u95F4",t.forEach(i=>{re[i]=function(){return console.error(s),Promise.reject(new P({code:"SYS_ERR",message:s}))}})}Object.assign(re,{get mixinDatacom(){return gs(re)}}),Vi(re),re.addInterceptor=Fn,re.removeInterceptor=ei,re.interceptObject=ti})();var j=re;function ms(n){function e(b,D){return b<<D|b>>>32-D}function t(b,D){var U,W,$,K,F;return $=b&2147483648,K=D&2147483648,U=b&1073741824,W=D&1073741824,F=(b&1073741823)+(D&1073741823),U&W?F^2147483648^$^K:U|W?F&1073741824?F^3221225472^$^K:F^1073741824^$^K:F^$^K}function s(b,D,U){return b&D|~b&U}function i(b,D,U){return b&U|D&~U}function o(b,D,U){return b^D^U}function a(b,D,U){return D^(b|~U)}function r(b,D,U,W,$,K,F){return b=t(b,t(t(s(D,U,W),$),F)),t(e(b,K),D)}function u(b,D,U,W,$,K,F){return b=t(b,t(t(i(D,U,W),$),F)),t(e(b,K),D)}function c(b,D,U,W,$,K,F){return b=t(b,t(t(o(D,U,W),$),F)),t(e(b,K),D)}function y(b,D,U,W,$,K,F){return b=t(b,t(t(a(D,U,W),$),F)),t(e(b,K),D)}function m(b){for(var D,U=b.length,W=U+8,$=(W-W%64)/64,K=($+1)*16,F=Array(K-1),Ve=0,pe=0;pe<U;)D=(pe-pe%4)/4,Ve=pe%4*8,F[D]=F[D]|b.charCodeAt(pe)<<Ve,pe++;return D=(pe-pe%4)/4,Ve=pe%4*8,F[D]=F[D]|128<<Ve,F[K-2]=U<<3,F[K-1]=U>>>29,F}function T(b){var D="",U="",W,$;for($=0;$<=3;$++)W=b>>>$*8&255,U="0"+W.toString(16),D=D+U.substr(U.length-2,2);return D}var h=Array(),g,d,l,w,I,f,p,_,v,M=7,E=12,q=17,X=22,H=5,te=9,Z=14,ie=20,ne=4,le=11,de=16,he=23,fe=6,ge=10,S=15,k=21;for(h=m(n),f=1732584193,p=4023233417,_=2562383102,v=271733878,g=0;g<h.length;g+=16)d=f,l=p,w=_,I=v,f=r(f,p,_,v,h[g+0],M,3614090360),v=r(v,f,p,_,h[g+1],E,3905402710),_=r(_,v,f,p,h[g+2],q,606105819),p=r(p,_,v,f,h[g+3],X,3250441966),f=r(f,p,_,v,h[g+4],M,4118548399),v=r(v,f,p,_,h[g+5],E,1200080426),_=r(_,v,f,p,h[g+6],q,2821735955),p=r(p,_,v,f,h[g+7],X,4249261313),f=r(f,p,_,v,h[g+8],M,1770035416),v=r(v,f,p,_,h[g+9],E,2336552879),_=r(_,v,f,p,h[g+10],q,4294925233),p=r(p,_,v,f,h[g+11],X,2304563134),f=r(f,p,_,v,h[g+12],M,1804603682),v=r(v,f,p,_,h[g+13],E,4254626195),_=r(_,v,f,p,h[g+14],q,2792965006),p=r(p,_,v,f,h[g+15],X,1236535329),f=u(f,p,_,v,h[g+1],H,4129170786),v=u(v,f,p,_,h[g+6],te,3225465664),_=u(_,v,f,p,h[g+11],Z,643717713),p=u(p,_,v,f,h[g+0],ie,3921069994),f=u(f,p,_,v,h[g+5],H,3593408605),v=u(v,f,p,_,h[g+10],te,38016083),_=u(_,v,f,p,h[g+15],Z,3634488961),p=u(p,_,v,f,h[g+4],ie,3889429448),f=u(f,p,_,v,h[g+9],H,568446438),v=u(v,f,p,_,h[g+14],te,3275163606),_=u(_,v,f,p,h[g+3],Z,4107603335),p=u(p,_,v,f,h[g+8],ie,1163531501),f=u(f,p,_,v,h[g+13],H,2850285829),v=u(v,f,p,_,h[g+2],te,4243563512),_=u(_,v,f,p,h[g+7],Z,1735328473),p=u(p,_,v,f,h[g+12],ie,2368359562),f=c(f,p,_,v,h[g+5],ne,4294588738),v=c(v,f,p,_,h[g+8],le,2272392833),_=c(_,v,f,p,h[g+11],de,1839030562),p=c(p,_,v,f,h[g+14],he,4259657740),f=c(f,p,_,v,h[g+1],ne,2763975236),v=c(v,f,p,_,h[g+4],le,1272893353),_=c(_,v,f,p,h[g+7],de,4139469664),p=c(p,_,v,f,h[g+10],he,3200236656),f=c(f,p,_,v,h[g+13],ne,681279174),v=c(v,f,p,_,h[g+0],le,3936430074),_=c(_,v,f,p,h[g+3],de,3572445317),p=c(p,_,v,f,h[g+6],he,76029189),f=c(f,p,_,v,h[g+9],ne,3654602809),v=c(v,f,p,_,h[g+12],le,3873151461),_=c(_,v,f,p,h[g+15],de,530742520),p=c(p,_,v,f,h[g+2],he,3299628645),f=y(f,p,_,v,h[g+0],fe,4096336452),v=y(v,f,p,_,h[g+7],ge,1126891415),_=y(_,v,f,p,h[g+14],S,2878612391),p=y(p,_,v,f,h[g+5],k,4237533241),f=y(f,p,_,v,h[g+12],fe,1700485571),v=y(v,f,p,_,h[g+3],ge,2399980690),_=y(_,v,f,p,h[g+10],S,4293915773),p=y(p,_,v,f,h[g+1],k,2240044497),f=y(f,p,_,v,h[g+8],fe,1873313359),v=y(v,f,p,_,h[g+15],ge,4264355552),_=y(_,v,f,p,h[g+6],S,2734768916),p=y(p,_,v,f,h[g+13],k,1309151649),f=y(f,p,_,v,h[g+4],fe,4149444226),v=y(v,f,p,_,h[g+11],ge,3174756917),_=y(_,v,f,p,h[g+2],S,718787259),p=y(p,_,v,f,h[g+9],k,3951481745),f=t(f,d),p=t(p,l),_=t(_,w),v=t(v,I);var x=T(f)+T(p)+T(_)+T(v);return x.toLowerCase()}function ro(n){let e=new Date,t=new Date(n),s=Math.floor((e-t)/1e3);if(t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()){if(s<60)return"\u521A\u521A";if(s<60*60)return`${Math.floor(s/60)}\u5206\u949F\u524D`;if(s<60*60*2){let l=Math.floor(s/3600),w=Math.floor((s-l*60*60)/60);return`${l}\u5C0F\u65F6 ${w}\u5206\u949F\u524D`}let h=t.getHours()>=12?"\u4E0B\u5348":"\u4E0A\u5348",g=t.getHours()%12||12,d=t.getMinutes().toString().padStart(2,"0");return`${h} ${g}:${d}`}let i=24*60*60*1e3;if(e-t<i*2)if(t.getDate()===e.getDate()-1&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()){let h=t.getHours()>=12?"\u4E0B\u5348":"\u4E0A\u5348",g=t.getHours()%12||12,d=t.getMinutes().toString().padStart(2,"0");return`\u6628\u5929 ${h} ${g}:${d}`}else{let h=t.getHours()>=12?"\u4E0B\u5348":"\u4E0A\u5348",g=t.getHours()%12||12,d=t.getMinutes().toString().padStart(2,"0");return`\u524D\u5929 ${h} ${g}:${d}`}let o=i*7;if(e-t<o){let h=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],g=t.getHours()>=12?"\u4E0B\u5348":"\u4E0A\u5348",d=t.getHours()%12||12,l=t.getMinutes().toString().padStart(2,"0");return`${h[t.getDay()]} ${g} ${d}:${l}`}let r=t.getFullYear(),u=(t.getMonth()+1).toString().padStart(2,"0"),c=t.getDate().toString().padStart(2,"0"),y=t.getHours()>=12?"\u4E0B\u5348":"\u4E0A\u5348",m=t.getHours()%12||12,T=t.getMinutes().toString().padStart(2,"0");return`${r}-${u}-${c} ${y} ${m}:${T}`}var Pn=[],Cn=[],Be={appShowIndex:0,appHideIndex:0,onAppShow(n){this.appShowIndex++,typeof n=="function"&&Pn.push(n),Pn.forEach(e=>e())},onAppHide(n){this.appHideIndex++,typeof n=="function"&&Cn.push(n),Cn.forEach(e=>e())}};setTimeout(()=>{Zt(function(){Be.onAppShow()},getApp().$vm.$),en(function(){Be.onAppHide()},getApp().$vm.$)},0);var ao=j.importObject("uni-id-co"),co=j.database(),Ln=co.collection("uni-id-users"),On=uni.getStorageSync("uni-id-pages-userInfo")||{},uo={userInfo:On,hasLogin:Object.keys(On).length!=0},lo={updateUserInfo(n=!1){return A(this,null,function*(){if(n)Ln.where("_id==$env.uid").update(n).then(e=>{e.result.updated?(uni.showToast({title:"\u66F4\u65B0\u6210\u529F",icon:"none",duration:3e3}),this.setUserInfo(n)):uni.showToast({title:"\u6CA1\u6709\u6539\u53D8",icon:"none",duration:3e3})});else{let e=j.importObject("uni-id-co",{customUI:!0});try{let t=yield Ln.where("'_id' == $cloudEnv_uid").field("mobile,nickname,username,email,avatar_file").get(),s=yield e.getRealNameInfo();this.setUserInfo(ee(N({},t.result.data[0]),{realNameAuth:s}))}catch(t){this.setUserInfo({},{cover:!0}),O("error","at uni_modules/uni-id-pages/common/store.js:57",t.message,t.errCode)}}})},setUserInfo(t){return A(this,arguments,function*(n,{cover:e}={cover:!1}){let s=e?n:Object.assign(be.userInfo,n);return be.userInfo=Object.assign({},s),be.hasLogin=Object.keys(be.userInfo).length!=0,uni.setStorageSync("uni-id-pages-userInfo",be.userInfo),n})},logout(){return A(this,null,function*(){if(j.getCurrentUserInfo().tokenExpired>Date.now())try{yield ao.logout()}catch(n){O("error","at uni_modules/uni-id-pages/common/store.js:76",n)}uni.removeStorageSync("uni_id_token"),uni.setStorageSync("uni_id_token_expired",0),uni.redirectTo({url:`/${Pe.uniIdRouter&&Pe.uniIdRouter.loginPage?Pe.uniIdRouter.loginPage:"uni_modules/uni-id-pages/pages/login/login-withoutpwd"}`}),uni.$emit("uni-id-pages-logout"),this.setUserInfo({},{cover:!0})})},loginBack(n={}){let{uniIdRedirectUrl:e=""}=n,t=0,s=getCurrentPages();if(s.forEach((i,o)=>{s[s.length-o-1].route.split("/")[3]=="login"&&t++}),e)return uni.redirectTo({url:e,fail:i=>{uni.switchTab({url:e,fail:o=>{O("log","at uni_modules/uni-id-pages/common/store.js:106",i,o)}})}});if(t){let i=Pe.pages[0];return uni.reLaunch({url:`/${i.path}`})}uni.navigateBack({delta:t})},loginSuccess(n={}){let{showToast:e=!0,toastText:t="\u767B\u5F55\u6210\u529F",autoBack:s=!0,uniIdRedirectUrl:i="",passwordConfirmed:o}=n;e&&uni.showToast({title:t,icon:"none",duration:3e3}),this.updateUserInfo(),uni.$emit("uni-id-pages-login-success"),s&&this.loginBack({uniIdRedirectUrl:i})}},be=(0,Ft.reactive)(uo),_s=j.database(),Re=_s.command,dt=class{constructor(e){this.indexDB=!1,this.isInit=!1,this.msgList=[],this.getMore=()=>A(this,null,function*(){if(this.cloudMsg.hasAfterStorage){let t=yield this.localMsgMaxTime(),s=this.msgListMinTime(),i=yield this.cloudMsg.get({minTime:t,maxTime:s});return i.length?i:(this.cloudMsg.hasAfterStorage=!1,this.getMore())}else if(this.localMsg.hasBeforeList){let t=this.msgListMinTime(),s=yield this.localMsg.get({maxTime:t});return s.length?s:(this.localMsg.hasBeforeList=!1,this.getMore())}if(this.cloudMsg.hasBeforeStorage){let t=this.msgList[0]?this.msgList[0].create_time:!1,s=yield this.cloudMsg.get({maxTime:t});return s.length?s:(this.cloudMsg.hasBeforeStorage=!1,[])}}),this.cloudMsg={hasAfterStorage:!0,hasBeforeStorage:!0,get:(...o)=>A(this,[...o],function*({minTime:t=0,maxTime:s=!1,limit:i=30}={}){let a={conversation_id:this.conversation_id};t&&s?a.create_time=Re.and([Re.gt(t),Re.lt(s)]):(t&&(a.create_time=Re.gt(t)),s&&(a.create_time=Re.lt(s)));let r=_s.collection("uni-im-msg"),u;try{u=(yield r.where(a).limit(i).orderBy("create_time","desc").get()).result.data.reverse()}catch(c){u=[]}return u.length&&this.localMsg.add(u,t===0?"unshift":"push"),u})},this.localMsg={maxTime:!1,hasBeforeList:!0,get:(...a)=>A(this,[...a],function*({minTime:t=0,maxTime:s=!1,limit:i=30,orderBy:o={create_time:"asc"}}={}){let r=`select * from msg WHERE conversation_id = "${this.conversation_id}" `;(s||t)&&(s&&(r+=`AND create_time < ${s} `),t&&(r+=`AND create_time > ${t} `)),r+='ORDER BY "create_time" DESC ',i&&(r+=`LIMIT ${i} `);let u=[];try{u=yield this.sqlite.selectSql(r)}catch(c){O("error","at uni_modules/uni-im/lib/MsgManager.js:208",c)}return u.map(c=>{try{let y={"&quot;":'"',"&#39;":"'","&lt;":"<","&gt;":">","&amp;":"&"};Object.keys(y).forEach(m=>{c.body=c.body.replace(new RegExp(m,"g"),y[m])}),c.body=JSON.parse(c.body)}catch(y){O("error","at uni_modules/uni-im/lib/MsgManager.js:228",y)}return c}).sort((c,y)=>o.create_time=="asc"?c.create_time-y.create_time:y.create_time-c.create_time)}),add:(t,s="push")=>A(this,null,function*(){Array.isArray(t)||(t=[t]),t.forEach(r=>A(this,null,function*(){r.unique_id=ms(JSON.stringify(r)+Math.random())}));let i=[];if(t.forEach(r=>A(this,null,function*(){let u=Object.keys(r),c=u.reduce((y,m)=>{if(m=="body"){let T=JSON.stringify(r.body);try{T=Mn(T)}catch(h){O("error","at uni_modules/uni-im/lib/MsgManager.js:342",h)}y+=`"${T}",`}else typeof r[m]=="string"?y+=`"${r[m]}",`:typeof r[m]=="undefined"?y+=`${null},`:y+=`${r[m]},`;return y},"").slice(0,-1);i.push(`insert into msg("${u.join('","')}") values (${c})`)})),i.length)try{yield this.sqlite.executeSql(i)}catch(r){O("log","at uni_modules/uni-im/lib/MsgManager.js:360",r)}let o=t.map(r=>r.create_time).sort((r,u)=>u-r)[0],a=yield this.localMsgMaxTime();o>(yield a)&&(this.localMsg.maxTime=o)}),update:(t,s)=>A(this,null,function*(){s=Object.assign({},s);let i="";for(let a in s)if(i+=`"${a}" = `,a=="body"){let r=JSON.stringify(s.body);try{r=Mn(r)}catch(u){O("error","at uni_modules/uni-im/lib/MsgManager.js:429",u)}i+=`"${r}",`}else typeof s[a]=="string"?i+=`"${s[a]}",`:typeof s[a]=="undefined"?i+=`${null},`:i+=`${s[a]},`;let o=`UPDATE msg SET ${i.slice(0,-1)} WHERE unique_id = "${t}"`;try{yield this.sqlite.executeSql(o)}catch(a){O("log","at uni_modules/uni-im/lib/MsgManager.js:444",a)}})},this.sqlite=getApp().globalData.sqlite,this.conversation_id=e.id,Object.defineProperty(this,"msgList",{get(){return e.isInit?e.msgList:[]},set(t){e.msgList=t}})}sleep(e){return A(this,null,function*(){return yield new Promise((t,s)=>{setTimeout(t,e)})})}localMsgMaxTime(){return A(this,null,function*(){if(this.localMsg.maxTime===!1){let e=yield this.localMsg.get({limit:1,orderBy:{create_time:"desc"}}),[t]=e;t?this.localMsg.maxTime=t.create_time:this.localMsg.maxTime=0}return this.localMsg.maxTime})}msgListMinTime(){let e=this.msgList[0];return e?e.create_time:0}},ho=/["'&<>]/;function Mn(n){var e=""+n,t=ho.exec(e);if(!t)return e;var s,i="",o=0,a=0;for(o=t.index;o<e.length;o++){switch(e.charCodeAt(o)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 39:s="&#39;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}a!==o&&(i+=e.substring(a,o)),a=o+1,i+=s}return a!==o?i+e.substring(a,o):i}function fo(n,e="imObservableData"){return typeof uni[e]=="undefined"&&(n=(0,Ft.reactive)(n),uni[e]=n),uni[e]}var oe=j.database(),En=j.importObject("uni-im-co",{customUI:!0});function xt(){return j.getCurrentUserInfo().uid}var R=fo({conversation:{dataList:[],hasMore:!0,loading:!1},currentConversationId:!1,heartbeat:"",friend:{dataList:[],hasMore:!0},group:{dataList:[],hasMore:!0},notification:{dataList:[],hasMore:!0},usersInfo:{},isWidescreen:!1,systemInfo:{},indexDB:!1,audioContext:!1,dataBaseIsOpen:!1,socketOpenIndex:0}),qt={conversation:{revokeMsg(o){return A(this,arguments,function*({msg_id:n,_id:e,conversation_id:t,user_id:s=!1,create_time:i}){if(e&&(n=e),!s)try{let m=yield En.revokeMsg(n)}catch(m){return O("log","at uni_modules/uni-im/lib/main.js:88","err",m),uni.showToast({title:m.message,icon:"none"})}let a=yield this.get(t),r=a.msgList,u=r.findIndex(m=>m._id==n);if(u!=-1){let m=r[u];m.is_revoke=!0,m.body="[\u6B64\u6D88\u606F\u5DF2\u88AB\u64A4\u56DE]",a.msgList.splice(u,1,Object.assign({},m))}let y=(yield a.msgManager.localMsg.get({minTime:i-1,maxTime:i+1})).find(m=>m._id==n);y&&(y.is_revoke=!0,y.body="[\u6B64\u6D88\u606F\u5DF2\u88AB\u64A4\u56DE]",a.msgManager.localMsg.update(y.unique_id,y))})},get(n){return A(this,null,function*(){let e=!1;if(n)if(typeof n=="object"){let{friend_uid:s,user_id:i,group_id:o,conversation_id:a}=n;if(e=a,i&&(s=i,n.friend_uid=i),!e){if(!o&&!s)throw O("log","at uni_modules/uni-im/lib/main.js:146","param---------",n),new Error("\u4F1A\u8BDD\u5BF9\u8C61\u4E0D\u8BE6\uFF0C\u8BF7\u68C0\u67E5\u53C2\u6570",n);e=mo.getConversationId(s||o,s?"single":"group")}}else if(typeof n=="string")e=n;else throw new Error("\u4F1A\u8BDD\u5BF9\u8C61\u4E0D\u8BE6\uFF0C\u8BF7\u68C0\u67E5\u53C2\u6570",n);let t=R.conversation.dataList;if(e&&(t=t.filter(s=>s.id==e),t.length==0)){let s=yield this.loadMore(e);if(s)t=[s];else{if(n.group_id)throw new Error("\u672A\u627E\u5230\u6B64\u7FA4\u4F1A\u8BDD");if(typeof n!="object")throw O("log","at uni_modules/uni-im/lib/main.js:170","param",n),new Error("\u53C2\u6570\u9519\u8BEF");if(!n.user_info){let o=yield j.database().collection("uni-id-users").doc(n.friend_uid).field("_id,nickname,avatar_file").get();if(O("log","at uni_modules/uni-im/lib/main.js:180","user_info",o),n.user_info=o.result.data[0],!n.user_info)throw new Error("\u7528\u6237\u67E5\u627E\u5931\u8D25")}let i={group_id:n.group_id,friend_uid:n.friend_uid,unread_count:0};try{let a=yield j.database().collection("uni-im-conversation").add(i)}catch(o){throw new Error(o)}i=Object.assign(i,{user_id:xt(),id:e,user_info:n.user_info,type:n.friend_uid?1:2,msgList:[],update_time:Date.now()}),this.add(i),t.push(i)}}if(e){let s=t[0];if(s.group_id&&Object.keys(s.group_member).length==0){let i=yield oe.collection(oe.collection("uni-im-group-member").where({group_id:s.group_id}).getTemp(),oe.collection("uni-id-users").field("_id,nickname,avatar_file").getTemp()).limit(1e3).get(),o={};i.result.data.forEach(a=>{let r=a.user_id[0];o[r._id]=r}),qt.mergeUsersInfo(o),s.group_member=o}return s.isInit||(s.msgManager=new dt(s)),s}else return t})},loadMore(n){return A(this,null,function*(){if(!n){if(R.conversation.loading)return[];R.conversation.loading=!0}let e=yield this.get(),t=e[e.length-1],s=t?t.update_time:"";n&&(s="");let i={data:[]};try{i=yield En.getConversationList({maxUpdateTime:s,limit:30,conversation_id:n})}catch(o){O("log","at uni_modules/uni-im/lib/main.js:286",o),n||(R.conversation.loading=!1)}if(i.data.length&&this.add(i.data),n)return i.data[0];{R.conversation.loading=!1,R.conversation.hasMore=i.data.length==30;let o="user_id == $cloudEnv_uid",a=i.data.filter(u=>u.group_id).map(u=>u.group_id)||[];a.length&&(o=`(user_id == $cloudEnv_uid || "group_id" in ${JSON.stringify(a)})`);let r=uni.getStorageSync("uni-im-lastTaskTime");return r&&(o+=`&& "create_time" > ${r}`),oe.collection("uni-im-task").where(o).orderBy("create_time desc").get().then(u=>{u.result.data.length&&(u.result.data.forEach(c=>{c.type=="revoke_msg"&&this.revokeMsg(c.payload)}),uni.setStorageSync("uni-im-lastTaskTime",u.result.data[0].create_time))}).catch(u=>{O("error","at uni_modules/uni-im/lib/main.js:333",u)}),i.data}})},add(n){return Array.isArray(n)||(n=[n]),n.forEach(e=>{Array.isArray(e.user_info)&&(e.user_info=e.user_info[0]),Array.isArray(e.group_info)&&(e.group_info=e.group_info[0],e.group_id&&(e.group_member||(e.group_member={}),e.group_info.introduction===void 0&&(e.group_info.introduction=""),e.group_info.avatar_file===void 0&&(e.group_info.avatar_file={url:""}))),e=Object.assign(e,{isInit:!1,title:"",chatText:"",avatar_file:{},call_list:[]}),e.user_info?Object.defineProperties(e,{title:{get(){return e.user_info.nickname}},avatar_file:{get(){return e.user_info.avatar_file}},group_info:{value:!1}}):e.group_info?Object.defineProperties(e,{title:{get(){return e.group_info.name}},avatar_file:{get(){return e.group_info.avatar_file}},user_info:{value:!1}}):O("error","at uni_modules/uni-im/lib/main.js:412","\u4F1A\u8BDD\u5217\u8868\u5931\u6548\uFF0C\u7591\u4F3C\u5173\u8054\u7528\u6237/\u7FA4\u88AB\u5220\u9664(\u8BF7\u6539\u4E3A\u8F6F\u5220\u9664\u907F\u514D\u7CFB\u7EDF\u5F02\u5E38\uFF09\uFF1A",JSON.stringify(e));let t=e.update_time;Object.defineProperties(e,{last_msg_note:{get(){let r="\u6682\u65E0\u8BB0\u5F55",u=e.msgList[e.msgList.length-1];return e.chatText&&R.currentConversationId!=e.id&&(u={body:"[uni-im-draft]"+e.chatText,type:"text",create_time:Date.now()}),u&&(r="[\u591A\u5A92\u4F53]",u.type=="text"&&(r=u.body.toString(),r=r.replace(/[\r\n]/g,""),r=r.slice(0,30)),u.is_revoke&&(r="\u6D88\u606F\u5DF2\u88AB\u64A4\u56DE"),u.is_delete&&(r="\u6D88\u606F\u5DF2\u88AB\u5220\u9664")),r}},update_time:{get(){let r=e.msgList[e.msgList.length-1];return r?r.create_time:t}}});let{user_info:s,group_member:i}=e,o={};s&&(o[s._id]=s),qt.mergeUsersInfo(o),e.msgManager=new dt(e);let a=r=>{for(let c=0;c<r.length;c++){let y=r[c];y&&typeof y=="object"&&("is_delete"in y||(y.is_delete=!1))}return["push","unshift"].forEach(c=>{r[c]=function(){a(arguments),Array.prototype[c].apply(this,arguments)}}),r};a(e.msgList),e.msgList.clear=function(){this.length=0},Object.defineProperty(e,"msgList",{writable:!1}),R.conversation.dataList.find(r=>r.id==e.id)||R.conversation.dataList.push(e)}),uni.setStorage({key:"uni-im-conversation_uid:"+xt(),data:R.conversation}),n},unreadCount(){return R.conversation.dataList.reduce((e,t,s,i)=>e+t.unread_count,0)},remove(n){let e=R.conversation.dataList.findIndex(t=>t.id==n);R.conversation.dataList.splice(e,1)}},notification:{get:({type:n,excludeType:e}={})=>{let t=R.notification.dataList;return t?t.reduce((s,i)=>(n?(typeof n=="string"&&(n=[n]),n.includes(i.payload.subType)&&s.push(i)):e?(typeof e=="string"&&(e=[e]),e.includes(i.payload.subType)||s.push(i)):s.push(i),s),[]):!1},loadMore(){return A(this,null,function*(){let n=yield oe.collection("uni-im-notification").aggregate().match('"payload.type" == "uni-im-notification" && "user_id" == $cloudEnv_uid').sort({create_time:-1}).limit(1e3).end();this.add(n.result.data),this.hasMore==(n.result.data.length!=0)})},add(n){Array.isArray(n)||(n=[n]);let e=n.concat(R.notification.dataList);e.sort((o,a)=>o.create_time-a.create_time);let t={};for(var s=0;s<e.length;s++){let o=e[s],{subType:a,unique:r}=o.payload;t[r?a+"_"+r:Date.now()+"_"+s]=o}let i=[];for(let o in t){let a=t[o];i.push(a)}i.sort((o,a)=>a.create_time-o.create_time),R.notification.dataList=i},unreadCount(n={}){let t=this.get(n).reduce((s,i,o,a)=>(i.is_read||s++,s),0);return t===0?uni.removeTabBarBadge({index:2,complete:s=>{}}):uni.setTabBarBadge({index:2,text:t+"",complete:s=>{}}),t?t+"":""}},friend:{get(){return R.friend.dataList},loadMore(){return A(this,arguments,function*({friend_uid:n}={}){let e='"user_id" == $cloudEnv_uid';n&&(e+=`&& "friend_uid" == "${n}"`);let s=(yield oe.collection(oe.collection("uni-im-friend").where(e).field("friend_uid,mark,class_name").getTemp(),oe.collection("uni-id-users").field("_id,nickname,avatar_file").getTemp()).limit(500).get()).result.data;s.forEach((i,o)=>{s[o]=i.friend_uid[0];let a=s[o]._id;R.usersInfo[a]||(R.usersInfo[a]=i.friend_uid[0])}),R.friend.hasMore=s.length==500,R.friend.dataList.push(...s)})},remove(n){let e=R.friend.dataList,t=e.findIndex(s=>s._id==n);e.splice(t,1)}},group:{get(){return R.group.dataList},loadMore(){return A(this,arguments,function*({group_id:n}={}){let e='"user_id" == $cloudEnv_uid ';n&&(e+=`&& "group_id" == "${n}"`);let t=yield oe.collection(oe.collection("uni-im-group-member").where(e).getTemp(),oe.collection("uni-im-group").getTemp()).limit(500).get();t.result.data.map(s=>(s.group_info=s.group_id[0],delete s.group_id,s)),t.result.data=t.result.data.filter(s=>s.group_info),R.group.hasMore=t.result.data.length==500,n?R.group.dataList.push(...t.result.data):R.group.dataList=t.result.data})},remove({group_id:n}){let e=R.group.dataList,t=e.findIndex(s=>s.group_info._id==n);t!=-1&&e.splice(t,1)}},mergeUsersInfo(n){R.usersInfo=Object.assign({},R.usersInfo,n)},clearUnreadCount(n){return A(this,null,function*(){let e=yield this.conversation.get(n);setTimeout(function(){e.unread_count=0},10),j.database().collection("uni-im-conversation").where({user_id:xt(),id:n}).update({unread_count:0}).then(t=>{O("log","at uni_modules/uni-im/lib/main.js:760","\u8BBE\u7F6E\u4E3A\u5DF2\u8BFB",t.result.updated)})})}},go=function(n=[]){let e={};return n.forEach(t=>{let s=t,i=!1;if(t.includes(" as ")){let o=t.trim().split(" as ");s=o[0],i=o[1]}e[i||s]=function(){return R[s]}}),e},L=ys(R,qt,{mapState:go});function ys(){let n=arguments.length,e=arguments[0];At(e)||(e={});for(let t=1;t<n;t++){let s=arguments[t];if(At(s))for(let i in s)i==="__proto__"||e===s[i]||(At(s[i])?e[i]=ys(e[i],s[i]):e[i]=s[i])}return e}function At(n){return typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"}var Xe={name:"uni-im",path:"_doc/uni-im.db"},vs={init(n=()=>{}){return A(this,null,function*(){n()})},checkDataBaseIsOpen(){return A(this,null,function*(){if(L.dataBaseIsOpen)return!0;let n=plus.sqlite.isOpenDatabase(Xe);if(L.dataBaseIsOpen=n,!n){let e=yield new Promise((s,i)=>{plus.sqlite.openDatabase(ee(N({},Xe),{success:function(o){s(o)},fail:function(o){O("error","at uni_modules/uni-im/common/sqlite.js:26",o,"openDatabase failed: "+JSON.stringify(o)),i(o)}}))}),t=`create table if not exists msg(
					"_id" CHAR(32),
					"body" TEXT,
					"type" CHAR(32),
					"from_uid" CHAR(32),
					"to_uid" CHAR(32),
					"is_read" BOOLEAN,
					"friendly_time" DATETIME,
					"create_time" DATETIME,
					"conversation_id" CHAR(32),
					"group_id" CHAR(32),
					"client_create_time" DATETIME,
					"unique_id" CHAR(32),
					"appid" CHAR(32),
					"state" INT,
					"is_revoke" BOOLEAN,
					"is_delete" BOOLEAN,
					"action" TEXT
			)`;return this.executeSql(t),e}})},clearMsgTable(){return A(this,null,function*(){let n=yield this.executeSql("drop table msg");O("log","at uni_modules/uni-im/common/sqlite.js:58","clearMsgTable",n)})},executeSql(n){return A(this,null,function*(){return yield this.checkDataBaseIsOpen(),yield new Promise((e,t)=>{try{plus.sqlite.executeSql({name:Xe.name,sql:n,success:function(s){e(s)},fail:function(s){O("error","at uni_modules/uni-im/common/sqlite.js:77",s),O("error","at uni_modules/uni-im/common/sqlite.js:78",{sql:n}),O("error","at uni_modules/uni-im/common/sqlite.js:79","executeSql failed: "+JSON.stringify(s)),O("error","at uni_modules/uni-im/common/sqlite.js:80","executeSql failed: "+JSON.stringify(n)),t(s)}})}catch(s){t(s)}})})},selectSql(n){return A(this,null,function*(){return yield this.checkDataBaseIsOpen(),yield new Promise((e,t)=>A(this,null,function*(){try{plus.sqlite.selectSql({name:Xe.name,sql:n,success:function(s){e(s)},fail:function(s){O("error","at uni_modules/uni-im/common/sqlite.js:106","sql:"+n,"selectSql failed: "+JSON.stringify(s)),t(s)}})}catch(s){t(s)}}))})}};vs.init();var po=j.importObject("uni-id-co",{customUI:!0}),Dn=j.database(),Pt=!0,Ze=!1,et=!0,mo={init(){getApp().globalData.sqlite=vs,L.socketOpenIndex=0,uni.onSocketClose(function(o){et=!0,O("log","at uni_modules/uni-im/common/utils.js:43","WebSocket \u5DF2\u5173\u95ED\uFF01")}),uni.onSocketOpen(function(o){O("log","at uni_modules/uni-im/common/utils.js:46","WebSocket\u8FDE\u63A5\u5DF2\u6253\u5F00\uFF01"),et=!1,L.socketOpenIndex++,L.socketOpenIndex>1&&n()}),Be.onAppShow(()=>A(this,null,function*(){n()}));function n(){Ze||(Ze=!0,setTimeout(()=>A(this,null,function*(){let o=(yield L.conversation.get())[0];if(!o){Ze=!1;return}let a=yield Dn.collection("uni-im-msg").where({to_uid:j.getCurrentUserInfo().uid,create_time:Dn.command.gt(o.update_time)}).get();O("log","at uni_modules/uni-im/common/utils.js:82","getCloudMsg res",o.update_time,a.result.data);let r={};a.result.data.forEach(u=>{r[u.conversation_id]?r[u.conversation_id].push(u):r[u.conversation_id]=[u]});for(let u in r){let c=yield L.conversation.get(u),y=r[u];y.length&&(c.msgList.push(...y),c.msgManager.localMsg.add(y),c.unread_count+=y.length)}Ze=!1}),0))}this.listenImMsg(),setInterval(()=>{L.heartbeat=Date.now()},1e3);let e=uni.createInnerAudioContext(),t={};Object.defineProperty(t,"src",{set(o){e.src=o},get(){return e.src}}),L.audioContext=new Proxy(t,{get(o,a,r){return e[a]}}),L.systemInfo=uni.getSystemInfoSync();function s(){L.conversation.dataList=[],L.notification.dataList=[],L.notification.loadMore(),L.friend.dataList=[],L.friend.loadMore(),L.group.dataList=[],L.group.loadMore();let o={};o[be.userInfo._id]=be.userInfo,L.mergeUsersInfo(o)}j.getCurrentUserInfo().tokenExpired>Date.now()&&setTimeout(s,0),uni.$on("uni-id-pages-login-success",()=>A(this,null,function*(){s()})),uni.onPushMessage(o=>A(this,null,function*(){o.data.payload.type=="uni-im-notification"&&(O("log","at uni_modules/uni-im/common/utils.js:198","uni-im-notification-res.data",o.data),o.data.create_time=Date.now(),typeof o.data.is_read=="undefined"&&(o.data.is_read=!1),O("log","at uni_modules/uni-im/common/utils.js:203","res.data notification.add",o.data),o.data._id=o.data.payload.notificationId,o.data,delete o.data.payload.notificationId,delete o.data.unipush_version,L.notification.add(o.data))})),["navigateTo","redirectTo","reLaunch","switchTab","navigateBack"].forEach(o=>{uni.addInterceptor(o,{success:a=>{i()}})});function i(){setTimeout(()=>{let o=L.notification.unreadCount();a(2,o),o=L.conversation.unreadCount(),a(0,o);function a(r,u){u==0?uni.removeTabBarBadge({index:r,complete:c=>{}}):uni.setTabBarBadge({index:r,text:u+"",complete:c=>{}})}},300)}uni.$on("uni-id-pages-logout",()=>{L.conversation.dataList=[],L.conversation.hasMore=!0,L.notification.dataList=[],L.notification.hasMore=!0,L.friend.dataList=[],L.friend.hasMore=!0,L.group.dataList=[],L.group.hasMore=!0,L.currentConversationId=!1}),Be.onAppHide(()=>A(this,null,function*(){Pt=!1})),Be.onAppShow(()=>A(this,null,function*(){Pt=!0,this.clearPushNotify()}))},getConversationId(n,e="single"){if(e=="single"){let t=j.getCurrentUserInfo().uid;return t||O("error","at uni_modules/uni-im/common/utils.js:332","\u9519\u8BEFcurrent_uid\u4E0D\u80FD\u4E3A\u7A7A",t),"single_"+ms([n,t].sort().toString())}else return"group_"+n},listenImMsg(){uni.onPushMessage(n=>A(this,null,function*(){var e;O("log","at uni_modules/uni-im/common/utils.js:342","\u6536\u5230\u6D88\u606F",n);let{payload:t}=n.data;if(t.type=="uni-im"){let s=t.data;if(s.LongMsg){let o=yield j.database().collection("uni-im-msg").where({_id:s._id,conversation_id:s.conversation_id}).get();o.result.code==0?t.data.body=o.result.data[0].body:O("error","at uni_modules/uni-im/common/utils.js:363","\u8D85\u957F\u6587\u672C\u7C7B\u578B\u6D88\u606F\u67E5\u5E93\u5931\u8D25",s._id)}if(t.device_id==uni.getSystemInfoSync().deviceId)return O("log","at uni_modules/uni-im/common/utils.js:368","\u5F53\u524D\u8BBE\u5907\u53D1\u7684\u6D88\u606F\uFF0C\u4E0D\u7528\u63A5\u6536\uFF1B\u5FFD\u7565");if(n.type=="receive"){let{conversation_id:i,group_id:o}=s,a=getCurrentPages(),r=a[a.length-1].route;if(!Pt||!["uni_modules/uni-im/pages/chat/chat","uni_modules/uni-im/pages/index/index","uni_modules/uni-im/pages/userList/userList","uni_modules/uni-im/pages/contacts/contacts"].includes(r)){let{content:T,data:h,title:g,avatar_file:d}=t;d&&d.url;let l="_www/uni_modules/uni-im/static/avatarUrl.png";uni.getSystemInfoSync().platform=="android"&&d&&(l=(e=(yield uni.downloadFile({url:d.url}))[1])==null?void 0:e.tempFilePath),plus.push.createMessage(T,t,{title:g,icon:l})}else i!=L.currentConversationId;let c=yield L.conversation.get(i),y=c.msgList,m=[...y].pop();if(m&&m._id!=s._id&&(y.push(s),c.unread_count++),et||c.msgManager.localMsg.add(s),s.group_id&&s.about_msg_id){let T=j.getCurrentUserInfo().uid,h=y.find(g=>g._id==s.about_msg_id);h&&h.from_uid==T&&(c.call_list.push(s._id),O("log","at uni_modules/uni-im/common/utils.js:439","conversation.call_list",c.call_list))}if(s.action=="join-group-notice"){O("log","at uni_modules/uni-im/common/utils.js:450",'"join-group-notice"',s);let T=yield L.conversation.get(s.conversation_id);if(O("log","at uni_modules/uni-im/common/utils.js:452",'"join-group-notice"conversation',T),T){let h=s.body.user_list;if(h&&Object.keys(T.group_member)){for(let d=0;d<h.length;d++)T.group_member[h[d]._id]=h[d];O("log","at uni_modules/uni-im/common/utils.js:465","add user to group_member",T.group_member)}L.mergeUsersInfo(T.group_member),L.group.dataList.find(d=>d.group_info._id==o)||(yield L.group.loadMore({group_id:o}))}}}else{let i=getCurrentPages();i[i.length-1].route=="uni_modules/uni-im/pages/chat/chat"?uni.redirectTo({url:"/uni_modules/uni-im/pages/chat/chat?conversation_id="+s.conversation_id,complete(a){O("log","at uni_modules/uni-im/common/utils.js:490",a)}}):uni.navigateTo({url:"/uni_modules/uni-im/pages/chat/chat?conversation_id="+s.conversation_id,complete(a){O("log","at uni_modules/uni-im/common/utils.js:497",a)}})}}else if(t.type=="uni-im-group-exit"||t.type=="uni-im-group-expel"||t.subType=="uni-im-group-expel"){let{timestamp:s,group_id:i}=t.data,o="group_"+i,a=n.data.content,r=yield L.conversation.get(o),u={conversation_id:o,group_id:i,client_create_time:Date.now(),create_time:Date.now(),type:"system",body:a};if(r.msgList.push(u),et||r.msgManager.localMsg.add(u),t.data.user_id==j.getCurrentUserInfo().uid){let c=L.currentConversationId,y=Rn(),{route:m,options:T}=y.$page;m=="uni_modules/uni-im/pages/group/info"&&(c=T.conversation_id),c=="group_"+t.data.group_id&&uni.navigateBack({delta:2}),setTimeout(()=>{L.conversation.remove(o),L.group.remove({group_id:t.data.group_id})},1e3)}else{let c=yield L.conversation.get(o);delete c.group_member[t.data.user_id]}}else if(t.type=="uni-im-group-join-request")O("log","at uni_modules/uni-im/common/utils.js:573","\u6709\u7528\u6237\u7533\u8BF7\u52A0\u5165\u7FA4\u804A");else if(t.type=="uni-im-notification"&&t.subType=="uni-im-group-cancellation"){let{group_id:s}=t.data,i="group_"+s,o=L.currentConversationId,a=Rn(),{route:r,options:u}=a.$page;r=="uni_modules/uni-im/pages/group/info"&&(o=u.conversation_id),o==i&&uni.navigateBack({delta:2}),setTimeout(()=>{L.conversation.remove(i),L.group.remove({group_id:s})},1e3)}else if(t.type=="uni-im-notification"&&t.subType=="uni-im-friend-add"){let{from_uid:s,to_uid:i}=t.data,o=s==j.getCurrentUserInfo().uid?i:s;yield L.conversation.get({friend_uid:o}),L.friend.loadMore({friend_uid:o})}else if(t.type=="uni-im-notification"&&t.subType=="uni-im-friend-delete"){let{from_uid:s,to_uid:i}=t.data,o=s==j.getCurrentUserInfo().uid?i:s;L.conversation.remove(t.data.conversationId),L.friend.remove(o)}else t.type=="uni-im-revoke-msg"&&(yield L.conversation.revokeMsg(t.data),uni.setStorageSync("uni-im-lastTaskTime",t.data.taskCreateTime))}))},toFriendlyTime(n){return n-Date.now()<3600*1e3*2&&(n+=L.heartbeat*0),n?ro(n):""},clearPushNotify(){plus.push.clear(),plus.runtime.setBadgeNumber(0)},login(t){return A(this,arguments,function*({token:n,tokenExpired:e}){uni.setStorage({key:"uni_id_token_expired",data:e}),uni.setStorage({key:"uni_id_token",data:n}),uni.getPushClientId({success:function(s){return A(this,null,function*(){let i=s.cid;yield po.setPushCid({pushClientId:i})})},fail(s){O("log","at uni_modules/uni-im/common/utils.js:688",s)}}),yield lo.updateUserInfo(),uni.$emit("uni-id-pages-login-success")})}};function Rn(){let n=getCurrentPages();return n[n.length-1]}var C=Ee(ke());var _o={"uni-list-chat":{"":{fontSize:16,position:"relative",flexDirection:"column",justifyContent:"space-between",backgroundColor:"#ffffff"}},"uni-list-chat--hover":{"":{backgroundColor:"#f5f5f5"}},"uni-list--border":{"":{position:"relative",marginLeft:15,borderTopColor:"#e5e5e5",borderTopStyle:"solid",borderTopWidth:.5}},"uni-list-chat--first":{"":{borderTopWidth:0}},"uni-ellipsis":{"":{lines:1}},"uni-ellipsis-2":{"":{lines:2}},"uni-list-chat__container":{"":{position:"relative",flexDirection:"row",flex:1,paddingTop:10,paddingRight:15,paddingBottom:10,paddingLeft:15,overflow:"hidden"}},"uni-list-chat__header-warp":{"":{position:"relative"}},"uni-list-chat__header":{"":{flexDirection:"row",justifyContent:"center",alignItems:"center",flexWrap:"wrap-reverse",width:50,height:50,borderRadius:5,borderColor:"#eeeeee",borderWidth:1,borderStyle:"solid",overflow:"hidden"}},"uni-list-chat__header-box":{"":{width:50,height:50,overflow:"hidden",borderRadius:2}},"uni-list-chat__header-image":{"":{marginTop:1,marginRight:1,marginBottom:1,marginLeft:1,width:50,height:50}},"header--circle":{"":{borderRadius:50}},"uni-list-chat__content":{"":{flexDirection:"row",flex:1,overflow:"hidden",paddingTop:2,paddingRight:0,paddingBottom:2,paddingLeft:0}},"uni-list-chat__content-main":{"":{flexDirection:"column",justifyContent:"space-between",paddingLeft:10,flex:1,overflow:"hidden"}},"uni-list-chat__content-title":{"":{fontSize:16,color:"#3b4144",fontWeight:"normal",overflow:"hidden"}},draft:{"":{marginTop:3,color:"#eb3a41",fontSize:12,fontWeight:"normal",overflow:"hidden",paddingRight:3}},"uni-list-chat__content-note":{"":{marginTop:3,color:"#999999",fontSize:12,fontWeight:"normal",overflow:"hidden"}},"uni-list-chat__content-extra":{"":{flexDirection:"column",justifyContent:"space-between",alignItems:"flex-end",marginLeft:5}},"uni-list-chat__content-extra-text":{"":{color:"#999999",fontSize:12,fontWeight:"normal",overflow:"hidden"}},"uni-list-chat__badge-pos":{"":{position:"absolute",left:55,top:3}},"uni-list-chat__badge":{"":{justifyContent:"center",alignItems:"center",borderRadius:100,backgroundColor:"#ff5a5f"}},"uni-list-chat__badge-text":{"":{color:"#ffffff",fontSize:12}},"uni-badge--single":{"":{width:18,height:18}},"uni-badge--complex":{"":{left:50,height:18,paddingTop:0,paddingRight:6,paddingBottom:0,paddingLeft:6}},"uni-badge--dot":{"":{left:60,top:6,width:10,height:10,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0}},"uni-list-chat--right":{"":{left:0}}},Jt=45,yo={name:"UniListChat",emits:["click"],props:{title:{type:String,default:""},note:{type:String,default:""},clickable:{type:Boolean,default:!1},link:{type:[Boolean,String],default:!1},to:{type:String,default:""},badgeText:{type:[String,Number],default:""},badgePositon:{type:String,default:"right"},time:{type:String,default:""},avatarCircle:{type:Boolean,default:!1},avatar:{type:String,default:""},avatarList:{type:Array,default(){return[]}}},computed:{isDraft(){return this.note.slice(0,14)=="[uni-im-draft]"},isSingle(){return this.badgeText==="dot"?"uni-badge--dot":this.badgeText.toString().length>1?"uni-badge--complex":"uni-badge--single"},computedAvatar(){return this.avatarList.length>4?(this.imageWidth=Jt*.31,"avatarItem--3"):this.avatarList.length>1?(this.imageWidth=Jt*.47,"avatarItem--2"):(this.imageWidth=Jt,"avatarItem--1")}},watch:{avatar:{handler(n){n.substr(0,8)=="cloud://"?j.getTempFileURL({fileList:[n]}).then(e=>{let t=e.fileList||e.result.fileList;this.avatarUrl=t[0].tempFileURL}):this.avatarUrl=n},immediate:!0}},data(){return{isFirstChild:!1,border:!0,imageWidth:50,avatarUrl:""}},mounted(){this.list=this.getForm(),this.list&&(this.list.firstChildAppend||(this.list.firstChildAppend=!0,this.isFirstChild=!0),this.border=this.list.border)},methods:{getForm(n="uniList"){let e=this.$parent,t=e.$options.name;for(;t!==n;){if(e=e.$parent,!e)return!1;t=e.$options.name}return e},onClick(){if(this.to!==""){this.openPage();return}(this.clickable||this.link)&&this.$emit("click",{data:{}})},openPage(){["navigateTo","redirectTo","reLaunch","switchTab"].indexOf(this.link)!==-1?this.pageApi(this.link):this.pageApi("navigateTo")},pageApi(n){let e={url:this.to,success:t=>{this.$emit("click",{data:t})},fail:t=>{this.$emit("click",{data:t})}};switch(n){case"navigateTo":uni.navigateTo(e);break;case"redirectTo":uni.redirectTo(e);break;case"reLaunch":uni.reLaunch(e);break;case"switchTab":uni.switchTab(e);break;default:uni.navigateTo(e)}}}};function vo(n,e,t,s,i,o){return(0,C.openBlock)(),(0,C.createElementBlock)("cell",null,[(0,C.createElementVNode)("view",{hoverClass:!t.clickable&&!t.link?"":"uni-list-chat--hover",class:"uni-list-chat",onClick:e[0]||(e[0]=(0,C.withModifiers)((...a)=>o.onClick&&o.onClick(...a),["stop"]))},[(0,C.createElementVNode)("view",{class:(0,C.normalizeClass)({"uni-list--border":i.border,"uni-list-chat--first":i.isFirstChild})},null,2),(0,C.createElementVNode)("view",{class:"uni-list-chat__container"},[(0,C.createElementVNode)("view",{class:"uni-list-chat__header-warp"},[t.avatarCircle||t.avatarList.length===0?((0,C.openBlock)(),(0,C.createElementBlock)("view",{key:0,class:(0,C.normalizeClass)(["uni-list-chat__header",{"header--circle":t.avatarCircle}])},[(0,C.createElementVNode)("u-image",{class:(0,C.normalizeClass)(["uni-list-chat__header-image",{"header--circle":t.avatarCircle}]),src:i.avatarUrl,mode:"aspectFill"},null,10,["src"])],2)):((0,C.openBlock)(),(0,C.createElementBlock)("view",{key:1,class:"uni-list-chat__header"},[((0,C.openBlock)(!0),(0,C.createElementBlock)(C.Fragment,null,(0,C.renderList)(t.avatarList,(a,r)=>((0,C.openBlock)(),(0,C.createElementBlock)("view",{key:r,class:(0,C.normalizeClass)(["uni-list-chat__header-box",o.computedAvatar]),style:(0,C.normalizeStyle)({width:i.imageWidth+"px",height:i.imageWidth+"px"})},[(0,C.createElementVNode)("u-image",{class:"uni-list-chat__header-image",style:(0,C.normalizeStyle)({width:i.imageWidth+"px",height:i.imageWidth+"px"}),src:a.url,mode:"aspectFill"},null,12,["src"])],6))),128))]))]),(0,C.renderSlot)(n.$slots,"header"),t.badgeText&&t.badgePositon==="left"?((0,C.openBlock)(),(0,C.createElementBlock)("view",{key:0,class:(0,C.normalizeClass)(["uni-list-chat__badge uni-list-chat__badge-pos",[o.isSingle]])},[(0,C.createElementVNode)("u-text",{class:"uni-list-chat__badge-text"},(0,C.toDisplayString)(t.badgeText==="dot"?"":t.badgeText),1)],2)):(0,C.createCommentVNode)("",!0),(0,C.createElementVNode)("view",{class:"uni-list-chat__content"},[(0,C.createElementVNode)("view",{class:"uni-list-chat__content-main"},[(0,C.createElementVNode)("u-text",{class:"uni-list-chat__content-title uni-ellipsis"},(0,C.toDisplayString)(t.title),1),(0,C.createElementVNode)("view",{style:{"flex-direction":"row"}},[o.isDraft?((0,C.openBlock)(),(0,C.createElementBlock)("u-text",{key:0,class:"draft"},"[\u8349\u7A3F]")):(0,C.createCommentVNode)("",!0),(0,C.createElementVNode)("u-text",{class:"uni-list-chat__content-note uni-ellipsis"},(0,C.toDisplayString)(o.isDraft?t.note.slice(14):t.note),1)])]),(0,C.createElementVNode)("view",{class:"uni-list-chat__content-extra"},[(0,C.renderSlot)(n.$slots,"default",{},()=>[(0,C.createElementVNode)("u-text",{class:"uni-list-chat__content-extra-text"},(0,C.toDisplayString)(t.time),1),t.badgeText&&t.badgePositon==="right"?((0,C.openBlock)(),(0,C.createElementBlock)("view",{key:0,class:(0,C.normalizeClass)(["uni-list-chat__badge",[o.isSingle,t.badgePositon==="right"?"uni-list-chat--right":""]])},[(0,C.createElementVNode)("u-text",{class:"uni-list-chat__badge-text"},(0,C.toDisplayString)(t.badgeText==="dot"?"":t.badgeText),1)],2)):(0,C.createCommentVNode)("",!0)])])])])],8,["hoverClass"])])}var ws=Ae(yo,[["render",vo],["styles",[_o]]]);var B=Ee(ke());var we=Ee(ke());var wo={"uni-list":{"":{backgroundColor:"#ffffff",position:"relative",flexDirection:"column"}},"uni-list--border":{"":{position:"relative",borderTopColor:"#e5e5e5",borderTopStyle:"solid",borderTopWidth:.5,borderBottomColor:"#e5e5e5",borderBottomStyle:"solid",borderBottomWidth:.5,zIndex:-1}}},bo={name:"uniList","mp-weixin":{options:{multipleSlots:!1}},props:{stackFromEnd:{type:Boolean,default:!1},enableBackToTop:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},border:{type:Boolean,default:!0},renderReverse:{type:Boolean,default:!1}},created(){this.firstChildAppend=!1},methods:{loadMore(n){this.$emit("scrolltolower")},scroll(n){this.$emit("scroll",n)}}};function To(n,e,t,s,i,o){return(0,we.openBlock)(),(0,we.createElementBlock)("list",{bounce:!1,scrollable:!0,showScrollbar:"",renderReverse:t.renderReverse,onScroll:e[0]||(e[0]=(...a)=>o.scroll&&o.scroll(...a)),class:(0,we.normalizeClass)(["uni-list",{"uni-list--border":t.border}]),enableBackToTop:t.enableBackToTop,loadmoreoffset:"15"},[(0,we.renderSlot)(n.$slots,"default")],42,["renderReverse","enableBackToTop"])}var bs=Ae(bo,[["render",To],["styles",[wo]]]);var Io={container:{"":{width:"750rpx",alignItems:"center",flex:1,backgroundColor:"#ffffff"}},list:{"":{width:"750rpx",height:100}},btn:{"":{width:"600rpx",textAlign:"center",lineHeight:45,borderRadius:"20rpx"}}},Ts=j.database(),So={data(){return{friend_uid:"",friend_info:{username:"",nickname:"",avatar_file:{url:""}}}},props:{conversation_id:{default(){return!1}}},computed:{isFriend(){return L.friend.get().find(e=>e._id==this.friend_uid)}},onLoad(n){return A(this,null,function*(){this.load(n)})},mounted(){return A(this,null,function*(){this.conversation_id&&this.load({conversation_id:this.conversation_id})})},methods:{load(n){return A(this,null,function*(){if(n.conversation_id){let t=yield L.conversation.get(n.conversation_id);n.user_id=t.friend_uid}this.friend_uid=n.user_id;let e=yield Ts.collection("uni-id-users").doc(this.friend_uid).field("_id,nickname,avatar_file").get();this.friend_info=e.result.data[0]})},deteleFriend(){return A(this,null,function*(){uni.showModal({title:"\u786E\u8BA4\u8981\u5220\u9664\u597D\u53CB\u5417",content:"\u6B64\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500",showCancel:!0,cancelText:"\u53D6\u6D88",confirmText:"\u786E\u8BA4",complete:n=>A(this,null,function*(){if(n.confirm){uni.showLoading({mask:!0});try{yield Ts.collection("uni-im-friend").where({friend_uid:this.friend_uid,user_id:j.getCurrentUserInfo().uid}).remove(),uni.navigateBack({delta:2})}catch(e){uni.showModal({content:JSON.stringify(e.message),showCancel:!1})}uni.hideLoading()}})})})}}};function ko(n,e,t,s,i,o){let a=pt((0,B.resolveDynamicComponent)("uni-list-chat"),ws),r=pt((0,B.resolveDynamicComponent)("uni-list"),bs),u=(0,B.resolveComponent)("button");return(0,B.openBlock)(),(0,B.createElementBlock)("scroll-view",{scrollY:!0,showScrollbar:!0,enableBackToTop:!0,bubble:"true",style:{flexDirection:"column"}},[(0,B.createElementVNode)("view",{class:"container"},[(0,B.createVNode)(r,{border:!1,class:"list"},{default:(0,B.withCtx)(()=>[(0,B.createVNode)(a,{avatar:i.friend_info.avatar_file?i.friend_info.avatar_file.url:"/uni_modules/uni-im/static/avatarUrl.png",title:i.friend_info.nickname},null,8,["avatar","title"])]),_:1}),o.isFriend?((0,B.openBlock)(),(0,B.createBlock)(u,{key:0,class:"btn",plain:"",type:"warn",onClick:o.deteleFriend},{default:(0,B.withCtx)(()=>[(0,B.createTextVNode)("\u5220\u9664\u597D\u53CB")]),_:1},8,["onClick"])):((0,B.openBlock)(),(0,B.createElementBlock)("u-text",{key:1,style:{color:"#999","font-size":"14px"}},"- \u975E\u597D\u53CB\u7684\u4E34\u65F6\u4F1A\u8BDD\u65E0\u6CD5\u8BBE\u7F6E -"))])])}var ft=Ae(So,[["render",ko],["styles",[Io]]]);var zt=plus.webview.currentWebview();if(zt){let n=parseInt(zt.id),e="uni_modules/uni-im/pages/chat/info",t={};try{t=JSON.parse(zt.__query__)}catch(i){}ft.mpType="page";let s=Vue.createPageApp(ft,{$store:getApp({allowDefault:!0}).$store,__pageId:n,__pagePath:e,__pageQuery:t});s.provide("__globalStyles",Vue.useCssStyles([...__uniConfig.styles,...ft.styles||[]])),s.mount("#root")}})();
